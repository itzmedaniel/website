<!DOCTYPE html>
<!-- 
    ═══════════════════════════════════════════════════════════════════
    █▀▀▄ █▀▀█ █▀▀▄ ─▀─ █▀▀ █───   █── █▀▀█ █▀▀▄ █▀▀▀
    █──█ █▄▄█ █──█ ▀█▀ █▀▀ █───   █── █──█ █──█ █─▀█
    ▀▀▀─ ▀──▀ ▀──▀ ▀▀▀ ▀▀▀ ▀▀▀   ▀▀▀ ▀▀▀▀ ▀──▀ ▀▀▀▀
    ═══════════════════════════════════════════════════════════════════
    
    ⚠️  COPYRIGHT NOTICE ⚠️
    
    Website Design & Code © 2025 Daniel Long
    All Rights Reserved.
    
    This website's design, animations, and code are the intellectual 
    property of Daniel Long. Unauthorized copying, modification, or 
    distribution of this code is strictly prohibited.
    
    GitHub: https://github.com/itzmedaniel
    Contact: daniellong1109@gmail.com
    
    If you wish to use any portion of this code, please contact me
    for permission.
    
    Built with: Three.js, anime.js, Vite, Tailwind CSS
    Background effects: Reactbits.dev (converted to vanilla JS)
    ═══════════════════════════════════════════════════════════════════
-->
<!-- The class="dark" will be added/removed by JS -->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Daniel's Project</title>

    <!-- === START: LINK PREVIEW / SOCIAL EMBED TAGS === -->
    <!-- This is the general description for search engines -->
    <meta name="description" content="Daniel's Project Portfolio">
    
    <!-- Open Graph (OG) tags (for Facebook, Discord, LinkedIn, etc.) -->
    <meta property="og:title" content="Daniel's Project Portfolio" />
    <meta property="og:type" content="website" />
    <meta property="og:description" content="Daniel's Project Porfolio" />
    <!-- 
      IMPORTANT: Replace this with the final, public URL of your website.
      (e.g., https://your-username.github.io/your-repo/) 
    -->
    <meta property="og:url" content="https://itzmedaniel.github.io/website/" />
    <!-- 
      IMPORTANT: Replace this with a direct link to a larger preview image (e.g., 1200x630px).
      I'm using your favicon as a placeholder, but a dedicated image is much better.
    -->
    <meta property="og:image" content="https://raw.githubusercontent.com/itzmedaniel/website/main/favicon_io/apple-touch-icon.png" />
    
    <!-- Twitter Card tags (for Twitter/X) -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Daniel's Project Portfolio">
    <meta name="twitter:description" content="Daniel's Project Porfolio">
    <meta name="twitter:image" content="https://raw.githubusercontent.com/itzmedaniel/website/main/favicon_io/apple-touch-icon.png">
    <!-- === END: LINK PREVIEW / SOCIAL EMBED TAGS === -->
    
    <!-- === UPDATED FAVICON LINKS (using full raw GitHub URLs) === -->
    <link rel="apple-touch-icon" sizes="180x180" href="https://raw.githubusercontent.com/itzmedaniel/website/main/favicon_io/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="https://raw.githubusercontent.com/itzmedaniel/website/main/favicon_io/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="https://raw.githubusercontent.com/itzmedaniel/website/main/favicon_io/favicon-16x16.png">
    <link rel="manifest" href="https://raw.githubusercontent.com/itzmedaniel/website/main/favicon_io/site.webmanifest">
    <link rel="shortcut icon" href="https://raw.githubusercontent.com/itzmedaniel/website/main/favicon_io/favicon.ico">
    <!-- === END OF FAVICON LINKS === -->

    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    
    <script type="importmap">
    {
      "imports": {
        "three": "https://cdn.jsdelivr.net/npm/three@0.128.0/build/three.module.js",
        "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.128.0/examples/jsm/",
        "ogl": "/node_modules/ogl/dist/ogl.mjs"
      }
    }
    </script>
    
    <!-- Restored global anime.js script include -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
    
    <!-- Leaflet for Rain Radar Map -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>


    <style>
        /* Base styles */
        body {
            font-family: 'Inter', sans-serif;
            /* Default to light mode colors */
            background-color: #f3f4f6; /* Light gray background */
            color: #111827; /* Dark text */
            transition: background-color 0.3s, color 0.3s;
        }
        
        /* Dark mode styles */
        .dark body {
            background-color: #000000; /* Black "space" background */
            color: #f0f0f0; 
        }

        /* Specific text color overrides for themes */
        .text-container {
            color: #111827; /* Dark text for light mode */
        }
        .dark .text-container {
            color: #f0f0f0; /* Light text for dark mode */
        }

        .legend-box {
            /* Light mode */
            background-color: #ffffff;
            border: 1px solid #e5e7eb;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            transition: background-color 0.3s, opacity 0.3s, transform 0.3s; /* Added transform/opacity for bounce */
            /* Set position to absolute to allow dragging */
            position: absolute; 
            /* z-index is set in-line */
            opacity: 0; /* Start hidden for animation */
            border-radius: 0.75rem; /* Keep this rounded */
        }
        
        /* Dark mode */
        .dark .legend-box {
            background-color: #333333;
            border: 1px solid #4b5563;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }
        
        /* Light mode link hover */
        .nav-link:hover {
             background-color: #f3f4f6; /* Light gray hover */
        }
        
        /* Dark mode link hover */
        .dark .nav-link:hover {
            background-color: #4b5563; /* Darker gray hover */
        }

        /* Theme toggle button styling */
        .theme-btn {
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 0.6rem;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s, color 0.2s;
            border: 1px solid transparent;
        }
        
        /* Light mode toggle */
        .theme-btn {
            background-color: #e5e7eb;
            color: #374151;
        }
        .theme-btn.active {
            background-color: #60a5fa; /* Blue */
            color: #ffffff;
            border-color: #3b82f6;
        }
        
        /* Dark mode toggle */
        .dark .theme-btn.active {
            background-color: #60a5fa; /* Blue */
            color: #ffffff;
            border-color: #3b82f6;
        }

        /* Fullscreen canvas container */
        .graphic-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            z-index: 10; /* Behind UI */
            cursor: grab;
        }
        .graphic-container:grabbing {
            cursor: grabbing;
        }
        .dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 4px;
        }
        ::-webkit-scrollbar {
            /* Allow scrollbar for pages */
             width: 8px;
             height: 8px; /* Added for horizontal scroll */
        }
         ::-webkit-scrollbar-track {
            background: transparent; /* Make track invisible */
        }
         ::-webkit-scrollbar-thumb {
            background: #888; 
            border-radius: 4px;
        }
        .dark ::-webkit-scrollbar-thumb {
            background: #555;
        }


        canvas {
            /*
              FIX: 'none' prevents all default browser touch actions 
              (like page scroll or pinch-zoom) on the canvas,
              giving full control to the Three.js OrbitControls. 
            */
            touch-action: none;
            display: block;
            width: 100%;
            height: 100%;
        }
        
        /* Styles for subtitle letter animation */
        #anime-text-target {
            display: inline-block; /* Needed for transforms */
            white-space: nowrap; /* Prevent line breaks during animation */
            font-weight: bold;
        }
        #anime-text-target .letter {
            display: inline-block;
            opacity: 0; /* Start invisible */
            transform: translateY(10px); /* Start slightly down */
        }
        
        /* Styles for Page Content and Home Button */
        .page-content {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            z-index: 50; /* High z-index when visible */
            /* Adjusted padding for glass panel alignment */
            padding: 8rem 2rem 2rem 2rem; /* Increased top padding */
            overflow-y: auto; /* Enable scrolling within the page */
            /* FIXED: Transparent background so we can see the background effects */
            background-color: transparent;
            color: #111827; 
            transition: color 0.3s;
        }
        .dark .page-content {
            background-color: transparent;
            color: #f0f0f0; 
        }

        .home-button {
            position: fixed;
            top: 1.5rem; 
            left: 1.5rem; 
            z-index: 100; /* FIXED: Higher than page-content (50) */
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background-color 0.2s;
            background-color: #d1d5db; 
            color: #374151; 
        }
        .home-button:hover {
            background-color: #9ca3af; 
        }
        .dark .home-button {
             background-color: #4b5563; 
             color: #e5e7eb; 
        }
        .dark .home-button:hover {
            background-color: #6b7280; 
        }
        .hidden {
            display: none;
        }

        /* Styles for timezone/weather info */
        .info-item {
            display: flex;
            align-items: center;
            gap: 0.5rem; /* space-x-2 */
            font-size: 0.875rem; /* text-sm */
            font-weight: 500; /* font-medium */
            margin-top: 0.5rem; /* mt-2 */
        }
        .info-item svg {
             width: 1rem; /* w-4 */
             height: 1rem; /* h-4 */
             opacity: 0.7;
        }
        /* Smaller font for additional timezones */
        .timezone-grid {
             display: grid;
             grid-template-columns: auto 1fr;
             gap: 0.25rem 0.5rem;
             margin-top: 0.75rem; /* mt-3 */
             font-size: 0.75rem; /* text-xs */
             opacity: 0.8;
        }

        /* NEW: Hourly forecast container */
        #hourly-forecast-container {
            margin-top: 0.75rem; /* mt-3 */
            padding-bottom: 0.5rem; /* pb-2 */
            display: flex;
            flex-direction: row;
            gap: 0.75rem; /* space-x-3 */
            overflow-x: auto; /* Enable horizontal scroll */
            white-space: nowrap; /* Prevent wrapping */
            max-width: 100%; /* Ensure it fits width */
        }
        .forecast-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.25rem; /* space-y-1 */
            font-size: 0.75rem; /* text-xs */
            font-weight: 500; /* font-medium */
            padding: 0.25rem 0.5rem; /* p-1 px-2 */
            border-radius: 0.375rem; /* rounded-md */
            
            /* UPDATED: Added faint border */
            border: 1px solid rgba(0, 0, 0, 0.05);
            /* Light mode bg */
            background-color: rgba(0, 0, 0, 0.03);
        }
        .dark .forecast-item {
            /* UPDATED: Added faint border */
            border: 1px solid rgba(255, 255, 255, 0.1);
            /* Dark mode bg */
            background-color: rgba(255, 255, 255, 0.05);
        }
        .forecast-item svg {
            width: 1.25rem; /* w-5 */
            height: 1.25rem; /* h-5 */
            opacity: 0.8;
            /* UPDATED: fill is removed here, handled by paths */
        }
        .forecast-item .temp {
             font-weight: 600; /* font-semibold */
             font-size: 0.875rem; /* text-sm */
        }
        .forecast-item .precip {
            opacity: 0.6;
        }

        /* NEW: Sunset info */
        #sunset-info {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.75rem; /* text-xs */
            
        /* Rain Radar Widget Styles */
        #rain-radar-widget {
            border: 1px solid rgba(0, 0, 0, 0.1);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        .dark #rain-radar-widget {
            border: 1px solid rgba(255, 255, 255, 0.15);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }
        #rain-radar-map {
            filter: brightness(1.6) contrast(1.5) saturate(1.8);
            cursor: grab;
        }
        #rain-radar-map:active {
            cursor: grabbing;
        }
        .dark #rain-radar-map {
            filter: brightness(1.5) contrast(1.6) saturate(2.0);
        }
        .leaflet-container {
            background: #1a1a1a !important;
        }
        /* Style Leaflet zoom controls - TINY & MINIMALISTIC */
        .leaflet-control-zoom {
            border: none !important;
            box-shadow: none !important;
            margin: 3px !important;
        }
        .leaflet-control-zoom a {
            background: rgba(0, 0, 0, 0.25) !important;
            color: rgba(255, 255, 255, 0.7) !important;
            border: none !important;
            font-size: 10px !important;
            width: 14px !important;
            height: 14px !important;
            line-height: 14px !important;
            border-radius: 1px !important;
            font-weight: 100 !important;
            backdrop-filter: blur(1px);
            transition: all 0.15s ease;
        }
        .leaflet-control-zoom a:hover {
            background: rgba(0, 0, 0, 0.4) !important;
            color: rgba(255, 255, 255, 0.9) !important;
        }
        .leaflet-bar {
            border: none !important;
        }
        .leaflet-bar a {
            border-bottom: none !important;
        }
        .leaflet-bar a:first-child {
            border-radius: 1px 1px 0 0 !important;
        }
        .leaflet-bar a:last-child {
            border-radius: 0 0 1px 1px !important;
            margin-top: 0.5px !important;
        }
        .dark .leaflet-control-zoom a {
            background: rgba(255, 255, 255, 0.08) !important;
            color: rgba(255, 255, 255, 0.6) !important;
        }
        .dark .leaflet-control-zoom a:hover {
            background: rgba(255, 255, 255, 0.15) !important;
            color: rgba(255, 255, 255, 0.9) !important;
        }
        /* KL marker custom style */
        .kl-marker {
            background: transparent !important;
            border: none !important;
        }
        /* Leaflet popup styling */
        .leaflet-popup-content-wrapper {
            background: rgba(0, 0, 0, 0.8) !important;
            color: #fff !important;
            font-size: 11px !important;
            padding: 4px !important;
            border-radius: 4px !important;
        }
        .leaflet-popup-tip {
            background: rgba(0, 0, 0, 0.8) !important;
        }
            opacity: 0.7;
            margin-top: 0.5rem; /* mt-2 */
        }
         #sunset-info svg {
             width: 0.875rem; /* w-3.5 */
             height: 0.875rem; /* h-3.5 */
             /* UPDATED: fill is removed here, handled by paths */
         }


        /* --- START: FRONT PAGE CHROME METALLIC SHINE EFFECT (ULTRA SHARP CHROME) --- */
        
        /* OPTIMIZATION: Converted shine effect to pure CSS for performance */
        @keyframes shine-anim-light {
            0% { background-position-x: 100%; }
            100% { background-position-x: -300%; }
        }
        @keyframes shine-anim-dark {
            0% { background-position-x: 100%; }
            100% { background-position-x: -300%; }
        }

        #animated-title {
            white-space: nowrap;
            color: #111827; 
            
            /* Apply ULTRA SHARP Chrome Text Styling (Light Mode) */
            background: linear-gradient(
                90deg, 
                #111827 0%, 
                #000000 3%,    /* Deep Shadow */
                #ffffff 8%,    /* SHARP Highlight */
                #000000 13%,   /* Thin Shadow Line */
                #cccccc 25%,   /* Mid Gray */
                #ffffff 45%,   /* Center Highlight */
                #000000 55%,   /* Mid Shadow */
                #ffffff 70%,   /* Secondary Highlight */
                #333333 80%,   /* Final Shadow */
                #111827 100% 
            );
            background-size: 400% 100%;
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-position-x: 100%; 
            transition: color 0.3s;
            
            /* CSS Animation */
            animation: shine-anim-light 12s linear infinite;
        }

        .dark #animated-title {
            color: #f0f0f0; 
            background: linear-gradient(
                90deg, 
                #f0f0f0 0%, 
                #cccccc 3%,    /* Soft Highlight */
                #000000 8%,    /* SHARP Shadow */
                #333333 13%,   /* Mid Shadow Line */
                #777777 25%,   /* Mid Gray */
                #f0f0f0 45%,   /* Center Highlight */
                #000000 55%,   /* Sharp Shadow */
                #cccccc 70%,   /* Secondary Highlight */
                #333333 80%,   /* Final Shadow */
                #f0f0f0 100% 
            );
            background-size: 400% 100%;
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-position-x: 100%; 
            
            /* CSS Animation */
            animation: shine-anim-dark 12s linear infinite;
        }
        /* --- END: FRONT PAGE CHROME METALLIC SHINE EFFECT --- */


        /* --- START: DIRECTORY HEADING CHARACTER SLIDE ANIMATION STYLES --- */
        .animated-heading {
             display: block; 
             overflow: hidden; /* CRITICAL: Clips the sliding characters */
             white-space: nowrap; 
             color: inherit; /* Default solid text color fallback/reference */
        }
        /* Wraps the individual character to enforce the clip boundary */
        .animated-heading .anime-char-wrap {
            display: inline-block;
            overflow: hidden;
            vertical-align: top; 
        }
        /* The inner element that does the actual translation */
        .animated-heading .anime-char {
            display: inline-block;
            transform: translateY(100%); /* Starting position set by JS animation */
        }
        /* --- END: DIRECTORY HEADING CHARACTER SLIDE ANIMATION STYLES --- */

        /* FIX: Add rule for directory handle touch interaction */
        #directory-handle {
            /* Prevents the page from scrolling when the user
               is trying to drag the directory box handle. */
            touch-action: none;
        }


        /* UPDATED: Futuristic Glass Panel Styles (Opaque Inner) */
        .glass-panel {
             padding: 2rem; /* p-8 */
             border-radius: 0.75rem; /* rounded-xl */
             margin-bottom: 2rem; 
             position: relative; 
             z-index: 10; /* Above bouncing logo (8) */
             transform-style: preserve-3d; /* Enable 3D transforms */
             transform-origin: center center; /* Center transform origin */
             /* Light Mode */
             background: rgba(255, 255, 255, 0.8); 
             backdrop-filter: blur(12px) saturate(180%);
             -webkit-backdrop-filter: blur(12px) saturate(180%);
             
             /* Glow and Border (translucent blue/dark outline) */
             box-shadow: 
                 0 0 15px 3px rgba(59, 130, 246, 0.4), /* Outer glow */
                 inset 0 0 0 1px rgba(59, 130, 246, 0.3); /* Inner blue outline */
             border: 1px solid rgba(59, 130, 246, 0.2); /* Faint blue border */
             
             /* Initial hidden state for entrance animation */
             opacity: 0;
        }
         /* Dark Mode */
        .dark .glass-panel {
            background: rgba(25, 25, 25, 0.8); 
            backdrop-filter: blur(12px) saturate(180%);
             -webkit-backdrop-filter: blur(12px) saturate(180%);
            
            /* Glow and Border (translucent gray outline) */
            box-shadow: 
                0 0 20px 5px rgba(100, 100, 100, 0.3), /* Outer glow */
                inset 0 0 0 1px rgba(120, 120, 120, 0.3); /* Inner light outline */
            border: 1px solid rgba(120, 120, 120, 0.3); 
        }
        
        /* Footer style */
        .copyright-footer {
             font-size: 0.75rem;
             opacity: 0.6;
             text-align: center;
             margin-top: 1rem;
             margin-bottom: 1rem;
        }

        /* Bouncing Orb Style */
        .bouncing-orb {
            position: absolute;
            width: 300px;
            height: 300px;
            border-radius: 50%;
            z-index: -1; /* Place it behind the glass panel */
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            opacity: 0.2; /* Softer opacity */
            filter: blur(100px); /* Massive blur for soft glow */
            
            /* Dynamic color gradient */
            background: linear-gradient(135deg, #a78bfa 0%, #3b82f6 100%); /* Purple/Blue */
        }

        .dark .bouncing-orb {
            background: linear-gradient(135deg, #818cf8 0%, #34d399 100%); /* Lighter purple/green */
        }
        
        /* FaultyTerminal Background Container */
        .terminal-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            z-index: 1; /* Behind page content but visible */
            opacity: 0; /* Hidden by default with opacity, not display */
            pointer-events: none; /* Don't block interactions */
            will-change: opacity; /* GPU acceleration hint */
            visibility: hidden; /* Also hide from layout */
            transition: opacity 0.3s ease; /* Smooth fade in/out */
        }
        
        .terminal-background canvas {
            width: 100% !important;
            height: 100% !important;
            display: block;
            object-fit: cover;
            will-change: auto; /* Remove will-change to prevent constant recomposition */
        }
        
        /* Debug helper - remove after testing */
        .terminal-background.debug {
            border: 2px solid red;
            opacity: 1;
        }

        /* CardNav Styles - Simple Horizontal Navigation */
        .card-nav-container {
            position: fixed;
            top: 1.5rem;
            left: 50%;
            transform: translateX(-50%);
            width: auto;
            z-index: 100;
            transition: opacity 0.3s ease, transform 0.3s ease;
        }

        /* Hide CardNav on homepage */
        body.on-home .card-nav-container {
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
        }

        .card-nav {
            display: flex;
            align-items: center;
            padding: 0;
            background: transparent;
            border: none;
            box-shadow: none;
        }

        .nav-items {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: none;
            border-radius: 1.5rem;
            color: #1f2937;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .nav-item:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .dark .nav-item {
            background: rgba(50, 50, 50, 0.6);
            color: #f3f4f6;
        }

        .dark .nav-item:hover {
            background: rgba(70, 70, 70, 0.8);
        }

        .item-dot-canvas {
            width: 32px;
            height: 32px;
            flex-shrink: 0;
            display: block;
        }
        
        .item-dot {
            font-size: 10px;
            line-height: 1;
            flex-shrink: 0;
        }

        .item-title {
            white-space: nowrap;
            color: white;
        }
        
        .dark .item-title {
            color: white;
        }

        @media (max-width: 768px) {
            .card-nav-container {
                top: 0.5rem;
            }

            .nav-items {
                gap: 0.25rem;
            }

            .nav-item {
                padding: 0.375rem 0.75rem;
                font-size: 11px;
            }

            .item-dot-canvas {
                width: 6px;
                height: 6px;
            }
        }

        /* Form styling */
        .contact-input {
            width: 100%;
            padding: 0.75rem;
            border-radius: 0.5rem;
            border: 1px solid rgba(0, 0, 0, 0.1);
            background-color: rgba(255, 255, 255, 0.8);
            color: #111827;
            transition: border-color 0.2s, background-color 0.2s;
        }
        .contact-input:focus {
            outline: none;
            border-color: #3b82f6; /* Blue focus ring */
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.2);
        }

        .dark .contact-input {
            border: 1px solid rgba(255, 255, 255, 0.2);
            background-color: rgba(0, 0, 0, 0.4);
            color: #f0f0f0;
        }
        .dark .contact-input:focus {
            border-color: #60a5fa;
            box-shadow: 0 0 0 2px rgba(96, 165, 250, 0.3);
        }
        
        /* REMOVED: Gemini Button Style */
        
        /* REMOVED: Gemini Results Box */

        .social-icon-link {
            width: 3rem;
            height: 3rem;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: transform 0.2s, background-color 0.2s;
            /* Light mode base */
            background-color: #e5e7eb;
            color: #111827;
        }
        .social-icon-link:hover {
            transform: scale(1.1);
            background-color: #d1d5db;
        }

        .dark .social-icon-link {
            background-color: #374151;
            color: #f0f0f0;
        }
        .dark .social-icon-link:hover {
            background-color: #4b5563;
        }

        /* NEW: Class for animating H1 letters */
        .animated-h1-letter {
            display: inline-block;
        }

        /* NEW: Project item styling */
        .project-item {
            padding: 1.25rem; /* p-5 */
            border-radius: 0.75rem; /* rounded-xl */
            transition: background-color 0.3s, border-color 0.3s;
            
            /* Light mode */
            background-color: rgba(255, 255, 255, 0.6);
            border: 1px solid rgba(0, 0, 0, 0.1);
        }
        
        .dark .project-item {
            /* Dark mode */
            background-color: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .project-item h3 {
             font-size: 1.25rem; /* text-xl */
             font-weight: 600; /* font-semibold */
             margin-bottom: 0.5rem; /* mb-2 */
        }
        
        /* --- START: Bouncing Logo Styles --- */
        .bouncing-logo-element {
            position: absolute; /* UPDATED: Changed from fixed to absolute (inside page-content) */
            top: 0;
            left: 0;
            width: 100px; /* Logo size */
            height: 100px; /* Logo size */
            z-index: 5; /* UPDATED: Above backgrounds (1), below glass panels (10) */
            pointer-events: none; /* Don't block clicks */
            will-change: transform; /* Optimize for animation */
            
            /* === UPDATED URL HERE (using raw GitHub link) === */
            background-image: url('https://raw.githubusercontent.com/itzmedaniel/website/main/pochita.png');
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            
            /* Start hidden */
            display: none;
            visibility: visible;
            
            /* NEW: Blend mode and opacity for background effect */
            opacity: 1; /* UPDATED: Full opacity for visibility */
            /* REMOVED: mix-blend-mode: multiply; */
        }
        
        /* --- END: Bouncing Logo Styles --- */
        
        /* --- START: Signature/Watermark Styles --- */
        .signature-watermark {
            position: fixed;
            bottom: 10px;
            right: 15px;
            z-index: 9999;
            font-size: 11px;
            font-family: 'Courier New', monospace;
            opacity: 0.6;
            pointer-events: none;
            user-select: none;
            color: #666;
            text-shadow: 0 0 3px rgba(0, 0, 0, 0.3);
            transition: opacity 0.3s;
        }
        
        .dark .signature-watermark {
            color: #aaa;
            text-shadow: 0 0 3px rgba(255, 255, 255, 0.2);
        }
        
        .signature-watermark:hover {
            opacity: 0.9;
        }
        /* --- END: Signature/Watermark Styles --- */

        /* --- START: Mobile Responsive Styles --- */
        @media (max-width: 768px) {
            /* Optimize body for mobile */
            body {
                font-size: 14px;
                overflow-x: hidden;
            }

            /* Top left UI adjustments - Add more breathing room */
            #top-left-ui {
                left: 1.5rem !important;
                right: 1.5rem;
                top: 5rem !important;
                max-width: calc(100% - 3rem);
            }

            #animated-title {
                font-size: 2.5rem !important; /* Larger, more readable title */
                max-width: 100%;
                margin-bottom: 1rem !important;
            }

            #top-left-ui p {
                font-size: 1rem;
                max-width: 100%;
                line-height: 1.6;
                margin-bottom: 1.5rem;
            }

            /* Weather and timezone info - More spacing */
            .info-item {
                font-size: 0.875rem;
                gap: 0.5rem;
                margin-bottom: 0.75rem;
            }

            .info-item svg {
                width: 1rem;
                height: 1rem;
            }

            .timezone-grid {
                font-size: 0.75rem;
                gap: 0.5rem 1rem;
                margin-top: 1rem;
            }

            /* Hourly forecast - More spacing between items */
            #hourly-forecast-container {
                gap: 1rem;
                padding: 1rem;
                margin-bottom: 1.5rem;
            }

            .forecast-item {
                min-width: 60px;
                padding: 0.75rem;
            }

            .forecast-item svg {
                width: 1.5rem;
                height: 1.5rem;
                margin: 0.5rem 0;
            }

            /* Rain radar widget - Taller and more prominent */
            #rain-radar-widget {
                max-width: 100% !important;
                height: 220px !important;
                margin-bottom: 1.5rem;
            }

            /* Directory box - Better sizing and spacing */
            #directory-box {
                width: 140px !important;
                padding: 1rem !important;
                font-size: 0.875rem;
                top: auto !important;
                bottom: 1.5rem !important;
                left: 1.5rem !important;
                right: auto !important;
            }

            #directory-box h2 {
                font-size: 0.75rem;
                margin-bottom: 0.75rem;
                letter-spacing: 0.5px;
            }

            #directory-box .nav-link {
                padding: 0.75rem 0.5rem;
                font-size: 0.75rem;
                margin-bottom: 0.25rem;
            }

            #directory-box .dot {
                width: 0.5rem;
                height: 0.5rem;
                margin-right: 0.5rem;
            }

            #directory-box .theme-btn {
                font-size: 0.625rem;
                padding: 0.375rem 0.5rem;
                margin: 0.125rem;
            }

            #drag-lock-btn svg {
                width: 0.75rem;
                height: 0.75rem;
            }

            /* Home button - Larger and more accessible */
            .home-button {
                width: 3rem;
                height: 3rem;
                top: 1.5rem;
                left: 1.5rem;
            }

            .home-button svg {
                width: 1.5rem;
                height: 1.5rem;
            }

            /* Page content - More padding and spacing */
            .page-content {
                padding: 6rem 1.5rem 3rem 1.5rem !important;
            }

            .glass-panel {
                padding: 2rem !important;
                margin-bottom: 1.5rem;
            }

            .glass-panel h1 {
                font-size: 2.25rem !important;
                margin-bottom: 1.5rem !important;
                line-height: 1.3;
            }

            .glass-panel h2 {
                font-size: 1.75rem !important;
                margin-bottom: 1.25rem !important;
                line-height: 1.3;
            }

            .glass-panel h3 {
                font-size: 1.25rem !important;
                margin-bottom: 1rem !important;
            }

            .glass-panel p, 
            .glass-panel li {
                font-size: 1rem;
                line-height: 1.7;
                margin-bottom: 1rem;
            }

            /* Project items - More spacing */
            .project-item {
                padding: 1.5rem;
                margin-bottom: 1rem;
            }

            /* Contact form - Better touch targets */
            .contact-input {
                padding: 1rem;
                font-size: 1rem;
                margin-bottom: 1rem;
            }

            /* Social icons - Larger for easier tapping */
            .social-icon-link {
                width: 3rem;
                height: 3rem;
                margin: 0.5rem;
            }

            .social-icon-link svg {
                width: 1.5rem;
                height: 1.5rem;
            }

            /* Bouncing orb - smaller on mobile */
            .bouncing-orb {
                width: 200px;
                height: 200px;
                filter: blur(60px);
            }

            /* Bouncing logo - smaller on mobile */
            .bouncing-logo-element {
                width: 60px !important;
                height: 60px !important;
            }

            /* Signature watermark */
            .signature-watermark {
                font-size: 9px;
                bottom: 8px;
                right: 8px;
                padding: 0.25rem 0.5rem;
            }

            /* CardNav adjustments for mobile - Better spacing */
            .card-nav-container {
                right: 1.5rem;
                max-height: 70vh;
            }

            .card-nav {
                width: 48px;
                height: 48px;
            }

            .card-nav.open {
                width: 200px;
            }

            .card-nav-top {
                width: 48px;
                min-width: 48px;
                min-height: 48px;
            }

            .hamburger-line {
                width: 18px;
            }

            .nav-card {
                min-height: 40px;
                padding: 10px 14px;
                font-size: 0.875rem;
                margin-bottom: 0.5rem;
            }

            .nav-card-label {
                font-size: 13px;
            }

            /* Disable hover effects on mobile for better performance */
            .nav-card:hover {
                box-shadow: none;
            }

            /* Make touch targets larger */
            button, 
            a,
            .nav-link,
            .theme-btn {
                min-height: 44px;
                min-width: 44px;
                display: inline-flex;
                align-items: center;
                justify-content: center;
            }

            #directory-box .nav-link,
            #directory-box .theme-btn {
                min-height: 32px;
                min-width: auto;
            }

            /* Exclude directory handle from touch target rules to allow dragging */
            #directory-handle {
                min-height: auto;
                min-width: auto;
                display: flex; /* Override inline-flex */
            }

            /* Hide some elements on very small screens */
            @media (max-width: 480px) {
                .timezone-grid {
                    display: none;
                }

                #rain-radar-widget {
                    height: 150px !important;
                }

                #directory-box {
                    width: 100px !important;
                    padding: 0.5rem !important;
                }

                .card-nav.open {
                    width: 160px;
                }
            }

            /* Landscape mode adjustments */
            @media (orientation: landscape) and (max-height: 500px) {
                #top-left-ui {
                    top: 2rem !important;
                }

                #directory-box {
                    bottom: 0.5rem !important;
                }

                .card-nav-container {
                    max-height: 85vh;
                }
            }

            /* MOBILE OPTIMIZATION: Simplify Homepage Layout */
            /* --- MOBILE: Directory box draggable and UI even smaller --- */
            #directory-box {
                position: fixed !important;
                z-index: 999 !important;
                top: auto !important;
                left: 0 !important;
                right: 0 !important;
                bottom: 0.5rem !important;
                margin: 0 auto !important;
                width: 98vw !important;
                max-width: 98vw !important;
                min-width: 0 !important;
                border-radius: 0.75rem !important;
                box-shadow: 0 2px 12px rgba(0,0,0,0.12) !important;
                touch-action: none !important;
                cursor: grab !important;
            }

            #directory-handle {
                display: flex !important;
                cursor: grab !important;
                background: rgba(0,0,0,0.04);
                border-radius: 0.5rem 0.5rem 0 0;
                padding: 0.25rem 0.5rem !important;
                font-size: 0.8rem !important;
            }

            /* UI even smaller for mobile */
            html, body, #main-content, .glass-panel, .page-content, #top-left-ui, #directory-box, .nav-link, .nav-item, .item-title, .item-dot-canvas, .theme-btn, .contact-input, .project-item, .bouncing-orb, .bouncing-logo-element, .signature-watermark, .card-nav-container, .card-nav, .nav-tabs, .nav-tab, .tab-pane, .nav-section, .section-title, .section-subtitle, .timezone-grid, .info-item, #animated-title, #top-left-ui p, .forecast-item, #rain-radar-widget, #rain-radar-map, #sunset-info, .social-icon-link, .glass-panel h1, .glass-panel h2, .glass-panel h3, .glass-panel p, .glass-panel li, .contact-form, textarea.contact-input {
                font-size: 0.7rem !important;
                padding: 0.18rem !important;
                margin: 0.12rem !important;
                line-height: 1.15 !important;
            }

            .item-dot-canvas {
                width: 12px !important;
                height: 12px !important;
            }

            .home-button {
                width: 22px !important;
                height: 22px !important;
                padding: 0.12rem !important;
                font-size: 0.7rem !important;
            }

            .theme-btn {
                padding: 0.12rem !important;
                font-size: 0.7rem !important;
                min-height: 20px !important;
            }

            .card-nav {
                width: 20px !important;
                height: 20px !important;
            }

            .card-nav.open {
                width: 65px !important;
            }

            .card-nav-top {
                width: 20px !important;
                min-width: 20px !important;
                min-height: 20px !important;
            }

            .hamburger-line {
                width: 8px !important;
            }

            .signature-watermark {
                font-size: 0.5rem !important;
                bottom: 2px !important;
                right: 2px !important;
                padding: 0.06rem 0.12rem !important;
            }

            /* --- END: Directory draggable and UI smaller --- */

            /* --- MOBILE KEYNOTE BANNER --- */
            #mobile-keynote-banner {
                display: block !important;
                position: fixed;
                top: 0;
                left: 0;
                width: 100vw;
                z-index: 2000;
                background: linear-gradient(90deg, #fbbf24 0%, #f59e42 100%);
                color: #222;
                font-size: 0.85rem;
                font-weight: 700;
                text-align: center;
                padding: 0.5rem 0.2rem;
                border-radius: 0 0 0.75rem 0.75rem;
                box-shadow: 0 2px 8px rgba(0,0,0,0.08);
                letter-spacing: 0.02em;
            }
            /* --- MAKE ALL UI VERY SMALL ON MOBILE --- */
            html, body, #main-content, .glass-panel, .page-content, #top-left-ui, #directory-box, .nav-link, .nav-item, .item-title, .item-dot-canvas, .theme-btn, .contact-input, .project-item, .bouncing-orb, .bouncing-logo-element, .signature-watermark, .card-nav-container, .card-nav, .nav-tabs, .nav-tab, .tab-pane, .nav-section, .section-title, .section-subtitle, .timezone-grid, .info-item, #animated-title, #top-left-ui p, .forecast-item, #rain-radar-widget, #rain-radar-map, #sunset-info, .social-icon-link, .glass-panel h1, .glass-panel h2, .glass-panel h3, .glass-panel p, .glass-panel li, .contact-form, textarea.contact-input {
                font-size: 0.85rem !important;
                padding: 0.35rem !important;
                margin: 0.18rem !important;
                line-height: 1.25 !important;
            }

            #main-content {
                padding: 0.25rem !important;
            }

            .glass-panel {
                padding: 0.5rem !important;
                margin: 0.18rem !important;
            }

            .glass-panel h1, .glass-panel h2, .glass-panel h3 {
                font-size: 1.1rem !important;
                margin-bottom: 0.3rem !important;
            }

            .glass-panel p, .glass-panel li {
                font-size: 0.85rem !important;
                margin-bottom: 0.25rem !important;
            }

            .nav-link, .nav-item {
                padding: 0.22rem 0.35rem !important;
                font-size: 0.75rem !important;
                gap: 0.18rem !important;
                min-height: 28px !important;
            }

            .item-dot-canvas {
                width: 16px !important;
                height: 16px !important;
            }

            .item-title {
                font-size: 0.75rem !important;
            }

            .home-button {
                width: 32px !important;
                height: 32px !important;
                padding: 0.18rem !important;
                font-size: 0.75rem !important;
            }

            .theme-btn {
                padding: 0.18rem !important;
                font-size: 0.75rem !important;
                min-height: 28px !important;
            }

            .contact-form {
                gap: 0.4rem !important;
            }

            textarea.contact-input {
                min-height: 50px !important;
                font-size: 0.85rem !important;
            }

            .timezone-grid {
                gap: 0.18rem !important;
            }

            #animated-title {
                font-size: 1.4rem !important;
            }

            #top-left-ui p {
                font-size: 0.85rem !important;
            }

            .forecast-item {
                min-width: 40px !important;
                padding: 0.18rem !important;
                font-size: 0.75rem !important;
            }

            #rain-radar-widget {
                height: 100px !important;
                max-width: 100vw !important;
            }

            #rain-radar-map {
                height: 100px !important;
            }

            #sunset-info {
                font-size: 0.75rem !important;
            }

            .social-icon-link {
                width: 28px !important;
                height: 28px !important;
            }

            .bouncing-orb {
                width: 60px !important;
                height: 60px !important;
                filter: blur(15px) !important;
            }

            .bouncing-logo-element {
                width: 28px !important;
                height: 28px !important;
            }

            .signature-watermark {
                font-size: 0.7rem !important;
                bottom: 4px !important;
                right: 4px !important;
                padding: 0.12rem 0.22rem !important;
            }

            .card-nav-container {
                top: 0.22rem !important;
                right: 0.22rem !important;
                max-height: 40vh !important;
            }

            .card-nav {
                width: 28px !important;
                height: 28px !important;
            }

            .card-nav.open {
                width: 90px !important;
            }

            .card-nav-top {
                width: 28px !important;
                min-width: 28px !important;
                min-height: 28px !important;
            }

            .hamburger-line {
                width: 12px !important;
            }

            .nav-card {
                min-height: 22px !important;
                padding: 0.18rem 0.3rem !important;
                font-size: 0.75rem !important;
                margin-bottom: 0.18rem !important;
            }

            .nav-card-label {
                font-size: 0.75rem !important;
            }

            /* --- END: MAKE ALL UI VERY SMALL ON MOBILE --- */
            #main-content {
                padding: 0.5rem;
            }

            /* Hide rain radar on mobile for cleaner look */
            #rain-radar-widget {
                display: none !important;
            }

            /* Simplify hourly forecast - show fewer items */
            .hourly-item:nth-child(n+5) {
                display: none;
            }

            /* Reduce weather graph height */
            #weather-chart {
                max-height: 150px !important;
            }

            /* Make directory box more compact and easier to use */
            #directory-box {
                font-size: 0.85rem;
                padding: 0.75rem 1rem 0.75rem 1rem !important;
                width: 100vw !important;
                max-width: 100vw !important;
                min-width: 0 !important;
                left: 0 !important;
                right: 0 !important;
                margin: 0 !important;
                border-radius: 0 0 18px 18px !important;
                position: relative !important;
                top: 0 !important;
                box-sizing: border-box !important;
                display: flex !important;
                flex-direction: row !important;
                align-items: center !important;
                justify-content: space-between !important;
                z-index: 20;
            }

            /* Place directory box below rain radar on mobile */
            #rain-radar-widget + #directory-box {
                margin-top: 0.5rem !important;
            }

            /* Make nav links horizontal inside directory box */
            #directory-box .nav-link,
            #directory-box .nav-items {
                flex-direction: row !important;
                display: flex !important;
                align-items: center !important;
                gap: 0.75rem !important;
                width: auto !important;
                min-width: 0 !important;
                padding: 0 !important;
            }

            #directory-box .nav-link {
                font-size: 0.85rem !important;
                padding: 0.5rem 0.75rem !important;
                min-width: 0 !important;
            }

            /* Theme switcher and other controls stack to right */
            #directory-box .theme-switcher {
                margin-left: auto !important;
                flex-shrink: 0;
            }

            /* Hide directory box shadow for flat look */
            #directory-box {
                box-shadow: none !important;
            }

            .nav-link {
                padding: 0.5rem 0.625rem;
                font-size: 0.75rem;
                gap: 0.375rem;
                min-height: 40px;
            }

            /* Simplify page content for better readability */
            .glass-panel {
                padding: 1.25rem !important;
                margin: 0.75rem !important;
            }

            .glass-panel h2 {
                font-size: 1.75rem !important;
                margin-bottom: 1rem !important;
            }

            .glass-panel p,
            .glass-panel li {
                font-size: 0.9rem !important;
                line-height: 1.6 !important;
            }

            /* Compact navigation for mobile */
            .card-nav-container {
                top: 0.75rem !important;
            }

            .nav-item {
                padding: 0.375rem 0.625rem !important;
                font-size: 0.65rem !important;
                gap: 0.25rem !important;
            }

            .item-dot-canvas {
                width: 20px !important;
                height: 20px !important;
            }

            .item-title {
                font-size: 0.7rem !important;
            }

            /* Home button more accessible on mobile */
            .home-button {
                bottom: 1rem !important;
                left: 1rem !important;
                width: 50px !important;
                height: 50px !important;
                padding: 0.875rem !important;
            }

            /* Reduce complex effects for better mobile performance */
            .glass-panel,
            .nav-item,
            #directory-box {
                backdrop-filter: blur(8px) !important;
                -webkit-backdrop-filter: blur(8px) !important;
            }

            /* Simplify theme switcher on mobile */
            .theme-btn {
                padding: 0.5rem !important;
                font-size: 0.7rem !important;
                min-height: 40px;
            }

            /* Better spacing for mobile forms */
            .contact-form {
                gap: 1rem;
            }

            textarea.contact-input {
                min-height: 120px;
            }

            /* Mobile: Stack timezone info vertically for better readability */
            .timezone-grid {
                display: flex;
                flex-direction: column;
                gap: 0.5rem;
            }

            /* Reduce title size on very small screens */
            @media (max-width: 380px) {
                #animated-title {
                    font-size: 2rem !important;
                }

                #top-left-ui p {
                    font-size: 0.875rem;
                }

                .nav-items {
                    gap: 0.125rem !important;
                }

                .nav-item {
                    padding: 0.25rem 0.5rem !important;
                }
            }
        }
        /* --- END: Mobile Responsive Styles --- */


    </style>
</head>
<!-- Removed padding from body -->
<body class="min-h-screen overflow-hidden on-home">
    <script>
    // Instantly set welcome splash background and text color before DOM paints, force pure white or black, and correct text color
    (function() {
        var style = document.createElement('style');
        var isDark = document.documentElement.classList.contains('dark') || window.matchMedia('(prefers-color-scheme: dark)').matches;
        style.innerHTML = isDark
            ? '#welcome-page{background:#000!important;} #welcome-letters{color:#fff!important;}'
            : '#welcome-page{background:#fff!important;} #welcome-letters{color:#111!important;}';
        document.head.appendChild(style);
    })();
    </script>

    <!-- SIMPLE WELCOME PAGE (shows once per refresh) -->
    <div id="welcome-page" style="position:fixed;z-index:3000;top:0;left:0;width:100vw;height:100vh;display:flex;align-items:center;justify-content:center;opacity:1;will-change:opacity;">
        <!-- Use data-text to avoid showing the full text before JS runs -->
        <h1 id="welcome-letters" data-text="Welcome." style="font-size:2.5rem;font-weight:800;letter-spacing:0.08em;will-change:opacity;visibility:hidden;"> </h1>
    </div>
    <style>
    /* Hide plain text until JS replaces it (prevents flash of full text) */
    #welcome-letters { visibility: hidden; }
    #welcome-letters span {
        opacity: 0;
        display: inline-block;
        transform: translateY(30px);
        will-change: transform, opacity;
    }
    </style>
    <script>
    // Use anime.js for smooth letter animation with a brief pause before fade out
    window.addEventListener('DOMContentLoaded', function() {
        var welcome = document.getElementById('welcome-page');
        var letters = document.getElementById('welcome-letters');
        // Read text from data attribute to avoid any FOUC
        var text = letters.getAttribute('data-text') || 'Welcome.';

        // Build spans using a DocumentFragment to avoid multiple reflows
        letters.innerHTML = '';
        var frag = document.createDocumentFragment();
        for (let i = 0; i < text.length; ++i) {
            var span = document.createElement('span');
            span.textContent = text[i];
            frag.appendChild(span);
        }
        letters.appendChild(frag);
        var spans = letters.querySelectorAll('span');

        // Make the letters container visible now that spans are in place
        letters.style.visibility = 'visible';

        // Create a timeline for precise control
        var timeline = anime.timeline({ autoplay: false });

        // Use a slightly smaller translate and tighter stagger to feel snappier
        timeline.add({
            targets: spans,
            opacity: [0, 1],
            translateY: [30, 0],
            easing: 'cubicBezier(.22,.11,.26,1)',
            duration: 700,
            delay: anime.stagger(90)
        });

        // Add fade out after a brief pause (start ~150ms after letters finish)
        timeline.add({
            targets: [welcome, letters],
            opacity: 0,
            duration: 1200,
            easing: 'easeInOutQuad',
            begin: function(anim) {
                // Debug logs to verify sequencing
                console.log('Welcome fade begin (should be ~150ms after letters complete)');
                // Ensure the browser optimizes the opacity transition
                welcome.style.willChange = 'opacity';
                letters.style.willChange = 'opacity';
            },
            complete: function() {
                // Hide the welcome page after fade out completes
                welcome.style.display = 'none';
                // Clean up will-change
                welcome.style.willChange = '';
                letters.style.willChange = '';
                console.log('Welcome fade complete - welcome element hidden');
            }
        }, '+=150');

        // Start the timeline on the next frame so layout has settled
        requestAnimationFrame(function() {
            // A trivial read to force layout before starting animation
            void letters.offsetHeight;
            timeline.play();
        });
    });
    </script>

    <!-- MOBILE KEYNOTE BANNER: Only visible on mobile -->
    <div id="mobile-keynote-banner" style="display:none;">
        For best experience, use <b>Desktop Mode</b> in your browser settings!
    </div>

    <script>
    // Show keynote banner only on mobile
    if (window.innerWidth <= 768) {
        document.getElementById('mobile-keynote-banner').style.display = 'block';
    }
    </script>

    <!-- FIXED: Background containers outside of page divs so they don't move with page animations -->
    <div id="backgrounds-container" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 1;">
        <div class="terminal-background" id="plasma-bg-aboutme" style="z-index: 1;"></div>
        <div class="terminal-background" id="terminal-bg-project" style="z-index: 1;"></div>
        <div class="terminal-background" id="liquid-chrome-bg-contact" style="z-index: 1;"></div>
        <div class="terminal-background" id="letter-glitch-bg-reference" style="z-index: 1;"></div>
    </div>

    <!-- CardNav Container -->
    <div class="card-nav-container" id="card-nav"></div>

    <!-- Signature Watermark -->
    <div class="signature-watermark">© 2025 Daniel Long</div>

    <!-- Home Button (initially hidden) -->
    <button id="home-button" class="hidden home-button" title="Back to Home">
        <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
        </svg>
    </button>
    
    <!-- Main Content Wrapper -->
    <div id="main-content">
        <!-- TOP LEFT TEXT SECTION -->
        <div id="top-left-ui" class="absolute z-20 text-container top-16 left-8 md:left-16 lg:left-32">
            <!-- The ID remains for animation targeting -->
            <h1 id="animated-title" class="max-w-sm text-4xl font-extrabold leading-tight tracking-tight md:text-5xl">
                Daniel's Project
            </h1>
            <!-- RESTORED span to subtitle -->
            <p class="max-w-xs mt-4 text-lg font-medium">
                Vibe coding, this project are mainly coded by Gemini AI and it consists of 
                <span id="anime-text-target" class="font-bold"></span> 
            </p>
            <!-- Timezone and Weather Info -->
            <div class="mt-4"> 
                <div id="timezone-info" class="info-item">
                    <!-- Clock Icon SVG -->
                    <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="currentColor" viewBox="0 0 16 16">
                         <path d="M8 3.5a.5.5 0 0 0-1 0V9a.5.5 0 0 0 .252.434l3.5 2a.5.5 0 0 0 .496-.868L8 8.71z"/>
                         <path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16m7-8A7 7 0 1 1 1 8a7 7 0 0 1 14 0"/>
                    </svg>
                    <span id="current-time">Loading time...</span> 
                    <span class="font-semibold">MYT</span>
                </div>
                <div id="weather-info" class="info-item">
                     <!-- Weather Icon Placeholder SVG (Sun) -->
                     <!-- Added explicit width/height classes for display robustness -->
                     <!-- UPDATED: SVG element is now just a container -->
                     <svg id="weather-icon" xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" viewBox="0 0 16 16">
                         <!-- Paths are updated by JS -->
                     </svg>
                    <span id="current-weather">Loading...</span>
                    <span>(Kuala Lumpur)</span>
                </div>
                 
                 <!-- NEW: Hourly Forecast Container (MOVED) -->
                 <div id="hourly-forecast-container">
                     <span class="text-xs opacity-70">Loading forecast...</span>
                 </div>
                 
                 <!-- NEW: Sunset info -->
                 <div id="sunset-info">
                     <!-- UPDATED: SVG element is now just a container -->
                     <svg id="sunset-icon-svg" xmlns="http://www.w3.org/2000/svg" class="w-3.5 h-3.5" viewBox="0 0 16 16">
                        <!-- Path updated by JS -->
                     </svg>
                     <span>Sunset will be at...</span>
                 </div>
                 
                 <!-- NEW: Rain Radar Widget (MOVED ABOVE TIMEZONE) -->
                 <div class="mt-3">
                     <h4 class="mb-1 text-xs font-semibold opacity-70">Live Rain Radar</h4>
                     <div id="rain-radar-widget" class="overflow-hidden rounded-lg" style="width: 100%; max-width: 300px; height: 220px; position: relative; background: rgba(0,0,0,0.3);">
                        <div id="rain-radar-map" style="width: 100%; height: 100%;"></div>
                     </div>
                 </div>

                 <!-- Additional Timezones Grid (MOVED) -->
                 <div class="timezone-grid">
                    <span>UTC:</span> <span id="utc-time">...</span>
                    <span>EST:</span> <span id="est-time">...</span>
                    <span>PST:</span> <span id="pst-time">...</span>
                    <span>CET:</span> <span id="cet-time">...</span>
                 </div>
            </div>
        </div>

        <!-- MAIN GRAPHIC CONTAINER -->
        <div class="graphic-container" id="canvas-container">
            <!-- The 3D canvas will be inserted here by Three.js -->
        </div>

        <!-- NAVIGATION BOX (BOTTOM RIGHT) -->
        <div id="directory-box" class="absolute z-20 w-40 p-2 rounded-lg text-container legend-box" style="top: 675px; left: 250px;">
            <h2 id="directory-handle" class="flex items-center justify-between mb-1.5 text-xs font-bold cursor-grab active:cursor-grabbing">
                <span>Directory</span>
                <button id="drag-lock-btn" class="p-0.5 text-gray-500 rounded-full dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-gray-600" title="Toggle drag lock">
                    <svg xmlns="http://www.w3.org/2000/svg" class="w-2.5 h-2.5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path id="lock-icon-path" stroke-linecap="round" stroke-linejoin="round" d="M18 9V7a4 4 0 00-8 0v2m8 0H6a2 2 0 00-2 2v6a2 2 0 002 2h12a2 2 0 002-2v-6a2 2 0 00-2-2z"></path>
                    </svg>
                </button>
            </h2>

            <!-- Links -->
            <div class="flex flex-col space-y-1">
                <button id="about-me-link" class="flex items-center p-1 text-xs font-semibold text-left transition-colors rounded-md nav-link">
                    <span class="w-1.5 h-1.5 mr-1.5 bg-blue-500 rounded-full dot"></span>
                    About Me
                </button>
                <button id="project-link" class="flex items-center p-1 text-xs font-semibold text-left transition-colors rounded-md nav-link">
                    <span class="w-1.5 h-1.5 mr-1.5 bg-orange-500 rounded-full dot"></span>
                    Project
                </button>
                <button id="contact-link" class="flex items-center p-1 text-xs font-semibold text-left transition-colors rounded-md nav-link">
                    <span class="w-1.5 h-1.5 mr-1.5 bg-green-500 rounded-full dot"></span>
                    Contact
                </button>
                <button id="reference-link" class="flex items-center p-1 text-xs font-semibold text-left transition-colors rounded-md nav-link">
                    <span class="w-1.5 h-1.5 mr-1.5 bg-purple-500 rounded-full dot"></span>
                    Reference
                </button>
            </div>

            <!-- THEME TOGGLE -->
            <div class="pt-1.5 mt-1.5 border-t border-gray-200 dark:border-gray-600">
                <h3 class="mb-1 text-xs font-bold">Theme</h3>
                <div class="flex justify-between space-x-1">
                    <button id="theme-light" class="theme-btn">Light</button>
                    <button id="theme-dark" class="theme-btn">Dark</button>
                    <button id="theme-system" class="theme-btn">System</button>
                </div>
            </div>
        </div>
    </div> <!-- End of main-content -->

    <!-- About Me Page Content (initially hidden) -->
    <div id="about-me-page" class="hidden page-content text-container">
        <!-- Width class max-w-6xl -->
        <div class="bouncing-orb" id="orb-aboutMe"></div>
        <!-- Bouncing Logo (between background and content) -->
        <div class="bouncing-logo-element"></div>
        <div class="max-w-6xl mx-auto glass-panel" style="position: relative; z-index: 10;"> 
            <h1 class="mb-6 text-4xl font-bold text-center animated-heading md:text-5xl">About Me</h1>
            <p class="mb-4 text-lg">
                Hello! I'm Daniel Long, i am currently a college student developing and improving my portfolio. 
            </p>
             <p class="mb-10 text-lg">
            </p>
             <p class="mt-10 text-lg"></p>
             <p class="mt-10 text-lg" style="min-height: 50vh;"></p> 
             <p class="mt-10 text-lg"></p>
        </div>
    </div>

    <!-- Project Page Content (initially hidden) -->
    <div id="project-page" class="hidden page-content text-container">
         <!-- Width class max-w-6xl -->
         <div class="bouncing-orb" id="orb-project"></div>
         <!-- Bouncing Logo (between background and content) -->
         <div class="bouncing-logo-element"></div>
         <div class="max-w-6xl mx-auto glass-panel" style="position: relative; z-index: 10;"> 
             <!-- ADDED CLASS: animated-heading -->
            <h1 class="mb-6 text-4xl font-bold text-center animated-heading md:text-5xl">Project</h1>
            <p class="mb-10 text-lg">
                There are no current project that i am working in right now, but you can refer to my github for my old projects
            </p>
            
            <!-- START: Project List -->
            <ul class="mt-8 space-y-6">
                
                <!-- Project 1: AI Model -->
                <li class="project-item">
                    <h3>Diabetes Risk AI Model</h3>
                    <p>
                        I made one of a basic not medically accurate diabetes risk ai model to calculate the risk of the patient. [I used linux OS or linux mint to develop this with the help of AI] (<a href="https://diabetes1-qvsdmydtrriixdicnfnzoj.streamlit.app/" target="_blank" class="text-blue-600 dark:text-blue-400 hover:underline">https://diabetes1-qvsdmydtrriixdicnfnzoj.streamlit.app/</a>)
                    </p>
                </li>
                
                <!-- Placeholder for future projects -->
                <li class="project-item opacity-70">
                    <h3>Future Project</h3>
                    <p>
                        More projects will be added here soon.
                    </p>
                </li>
            
            </ul>
            <!-- END: Project List -->

            <!-- === REMOVED: GEMINI AI PROJECT SUGGESTER === -->


             <!-- NOTE: The 'More project content...' ensures the main page scrollbar appears for the entire page content, as requested. -->
             <p class="mt-10 text-lg" style="min-height: 50vh;">Additional project content here to ensure the main page scrolls...</p> 
             <p class="mt-10 text-lg">End of Project page.</p>
        </div>
    </div>

    <!-- Contact Page Content (initially hidden) -->
    <div id="contact-page" class="hidden page-content text-container">
        <!-- Width class max-w-6xl -->
        <div class="bouncing-orb" id="orb-contact"></div>
        <!-- Bouncing Logo (between background and content) -->
        <div class="bouncing-logo-element"></div>
        <div class="max-w-6xl mx-auto glass-panel" style="position: relative; z-index: 10;"> 
            <!-- ADDED CLASS: animated-heading -->
            <h1 class="mb-6 text-4xl font-bold text-center animated-heading md:text-5xl">Contact</h1>
            
            <div class="flex flex-col space-y-6">
                <!-- Social Icons -->
                <div class="flex justify-center py-4 space-x-6 border-t border-b border-gray-200 dark:border-gray-600">
                    
                    <a href="https://www.linkedin.com/in/daniel-long-49ab9a33a?" target="_blank" class="social-icon-link" title="LinkedIn">
                        <!-- Updated LinkedIn Icon -->
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" viewBox="0 0 24 24" fill="currentColor"><path d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.136-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.671 7 3.336v5.9z"/></svg>
                    </a>
                    
                    <a href="https://www.instagram.com/grapejuicelemonade" target="_blank" class="social-icon-link" title="Instagram">
                        <!-- Updated Instagram Icon -->
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2.163c3.204 0 3.584.012 4.851.07 3.251.157 4.79 1.745 4.945 5.045.059 1.267.07 1.646.07 4.851s-.011 3.583-.07 4.851c-.157 3.298-1.744 4.887-5.045 4.944-1.267.059-1.646.07-4.851.07s-3.583-.011-4.851-.07c-3.299-.157-4.887-1.744-4.945-5.044-.059-1.267-.07-1.646-.07-4.851s.011-3.583.07-4.851c.157-3.251 1.744-4.79 5.044-4.945 1.268-.059 1.646-.07 4.851-.07zm0-2.163c-3.259 0-3.667.014-4.946.072-4.354.209-6.09 1.956-6.299 6.304-.058 1.279-.072 1.686-.072 4.947 0 3.26.014 3.667.072 4.946.208 4.348 1.945 6.089 6.299 6.298 1.279.058 1.686.072 4.946.072s3.667-.014 4.947-.072c4.354-.209 6.091-1.956 6.299-6.304.058-1.279.072 1.686.072-4.947s-.014-3.668-.072-4.946c-.209-4.348-1.945-6.089-6.299-6.298-1.279-.058-1.686-.072-4.946-.072zm0 5.838c-3.473 0-6.29 2.817-6.29 6.29s2.817 6.29 6.29 6.29 6.29-2.817 6.29-6.29-2.817-6.29-6.29-6.29zm0 10.373c-2.253 0-4.084-1.831-4.084-4.083s1.831-4.083 4.084-4.083 4.084 1.831 4.084 4.083-1.831 4.083-4.084 4.083zm7.042-14.774c0 1.277-1.034 2.31-2.31 2.31s-2.31-1.033-2.31-2.31c0-1.276 1.034-2.31 2.31-2.31s2.31 1.034 2.31 2.31z"/></svg>
                    </a>
                    
                    <a href="mailto:daniellong1109@gmail.com" target="_blank" class="social-icon-link" title="Gmail">
                        <!-- Updated Gmail Icon -->
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" viewBox="0 0 24 24" fill="currentColor"><path d="M0 4v16h24v-16h-24zm19.646 1.354l-7.646 6.646-7.646-6.646h15.292zm-15.292 14.292v-10.49l7.646 6.646 7.646-6.646v10.49h-15.292z"/></svg>
                    </a>

                     <a href="https://github.com/itzmedaniel" target="_blank" class="social-icon-link" title="GitHub">
                         <!-- Updated GitHub Icon -->
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" viewBox="0 0 24 24" fill="currentColor"><path d="M12 0c-6.626 0-12 5.374-12 12 0 5.302 3.438 9.8 8.207 11.387.6.11.82-.26.82-.577v-2.09c-3.338.724-4.042-1.61-4.042-1.61-.546-1.387-1.332-1.756-1.332-1.756-1.089-.745.083-.73.083-.73 1.205.085 1.838 1.233 1.838 1.233 1.065 1.837 2.809 1.305 3.495.998.108-.778.417-1.305.762-1.604-2.665-.304-5.466-1.333-5.466-5.93 0-1.31.464-2.383 1.234-3.221-.124-.304-.535-1.527.117-3.176 0 0 1.008-.322 3.301 1.23a11.396 11.396 0 0 1 2.502-.337c.831-.059 1.66-.059 2.502.337 2.292-1.552 3.3-1.23 3.3-1.157 1.353 1.649.242 2.872.118 3.176.77.838 1.234 1.911 1.234 3.221 0 4.59-2.805 5.62-5.478 5.92-.413.359-.817 1.082-.817 2.182v3.235c0 .318.219.687.823.575C20.56 21.802 24 17.301 24 12c0-6.626-5.374-12-12-12z"/></svg>
                    </a>
                </div>

                <!-- Contact Form -->
                <form action="https://formspree.io/f/meopqwan" method="POST" class="pt-4 space-y-4">
                    
                    <input type="email" name="_replyto" placeholder="Your Email" class="contact-input" required>
                    
                    <!-- === REMOVED: GEMINI AI MESSAGE DRAFTER === -->
                    
                    <textarea name="message" placeholder="Your Message" rows="5" class="resize-none contact-input" required></textarea>
                    
                    <button type="submit" class="w-full py-2 font-semibold text-white transition-colors duration-200 bg-blue-600 rounded-lg hover:bg-blue-700">
                        Send Message
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Reference Page Content (initially hidden) -->
    <div id="reference-page" class="hidden page-content text-container">
        <!-- Width class max-w-6xl -->
        <div class="bouncing-orb" id="orb-reference"></div>
        <!-- Bouncing Logo (between background and content) -->
        <div class="bouncing-logo-element"></div>
         <div class="max-w-6xl mx-auto glass-panel" style="position: relative; z-index: 10;"> 
            <h1 class="mb-6 text-4xl font-bold text-center animated-heading md:text-5xl">Reference</h1>
            <p class="mb-10 text-lg">
                The content and assets used in this project are referenced below to ensure proper attribution and prevent plagiarism.
            </p>
            <h2 class="mb-4 text-2xl font-bold">Model References (3D Assets)</h2>
            <ul class="mb-8 ml-4 space-y-2 list-disc list-inside">
                <li>
                    **Black Hole:** Uploaded by User (Source: Unknown, used with permission for personal project display).
                    <br><small class="opacity-70">Note: External model asset used for visual demonstration only.</small>
                </li>
                <li>
                    **MacBook:** Uploaded by User (Source: Unknown, used withpermission for personal project display).
                    <br><small class="opacity-70">Note: External model asset used for visual demonstration only.</small>
                </li>
            </ul>

            <h2 class="mb-4 text-2xl font-bold">Design & Technology References</h2>
            <ul class="mb-8 ml-4 space-y-2 list-disc list-inside">
                <li>
                    **Background Effects:** The animated background effects (Plasma, FaultyTerminal, LiquidChrome, and LetterGlitch) used on various pages were sourced from Reactbits.dev.
                    <br><a href="https://reactbits.dev" target="_blank" class="text-blue-400 hover:underline">https://reactbits.dev</a>
                    <br><small class="opacity-70">Note: Original React components were converted to vanilla JavaScript for this project.</small>
                </li>
                <li>
                    **AI Development Assistance:** This website's animations, UI structure, and complex logic were written with the assistance of a large language model (LLM), which acted as a development partner.
                    <br><small class="opacity-70">Acknowledged: Google Gemini</small>
                </li>
                 <li>
                    **Live Weather Data:** Live weather conditions provided by Open-Meteo.
                    <br><a href="https://open-meteo.com/" target="_blank" class="text-blue-400 hover:underline">https://open-meteo.com/</a>
                </li>
                <li>
                    **Live Rain Radar:** Rain radar visualization powered by RainViewer.
                    <br><a href="https://www.rainviewer.com/weather-radar-map-live.html" target="_blank" class="text-blue-400 hover:underline">https://www.rainviewer.com/weather-radar-map-live.html</a>
                </li>
                <li>
                    **Apple Website Design:** Inspiration for the overall aesthetic, especially the glassy, translucent UI elements.
                    <br><a href="https://www.apple.com/macbook-pro" target="_blank" class="text-blue-400 hover:underline">https://www.apple.com/macbook-pro</a>
                </li>
                <li>
                    **Anime.js Library:** Used for all custom page transitions, continuous hover effects, and text animations.
                    <br><a href="https://animejs.com" target="_blank" class="text-blue-400 hover:underline">https://animejs.com</a>
                </li>
                <li>
                    **Three.js:** JavaScript library used for creating and rendering the interactive 3D environment and models.
                    <br><a href="https://threejs.org" target="_blank" class="text-blue-400 hover:underline">https://threejs.org</a>
                </li>
                 <!-- NEW: Added PNG Reference -->
                <li>
                    **Pochita PNG:** Sourced from pnganime.com for the bouncing logo effect.
                    <br><a href="https://pnganime.com/gallery/puchita-png" target="_blank" class="text-blue-400 hover:underline">https://pnganime.com/gallery/puchita-png</a>
                </li>
                <li>
                    **Sketchfab Models (Reference for styling/display, actual files uploaded):**
                    <ul class="mt-1 ml-4 space-y-1 list-disc list-inside">
                        <li>Black Hole Concept: <a href="https://sketchfab.com/3d-models/black-hole-e410da98b1e5445eae2acafaaa53587d" target="_blank" class="text-blue-400 hover:underline">https://sketchfab.com/3d-models/black-hole-e410da98b1e5445eae2acafaaa53587d</a></li>
                        <li>MacBook Model: <a href="https://www.apple.com/macbook-pro" target="_blank" class="text-blue-400 hover:underline">https://www.apple.com/macbook-pro</a>
                    </ul>
                </li>
            </ul>
        </div>
    </div>


        <!-- Main 3D Logic -->
    <script type="module">
        import * as THREE from 'three';
        import { GLTFLoader } from 'three/addons/loaders/GLTFLoader.js';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';

        let scene, camera, renderer, controls, starField;
        let ambientLight, directionalLight;
        let container = document.getElementById('canvas-container');

        let blackHoleModel, macbookModel, activeModel;
        let isMacbookLoaded = false;
        let isBlackHoleLoaded = false;

        let animationFrameId = null;

        // Theme colors for 3D scene
        const themes = {
            light: {
                bgColor: new THREE.Color(0xf3f4f6), // Light gray
                ambientLight: 0.8,
                directionalLight: 1.5
            },
            dark: {
                bgColor: new THREE.Color(0x000000), // Black
                ambientLight: 0.5,
                directionalLight: 1.0
            }
        };

        // --- Theme Management ---
        const themeButtons = {
            light: document.getElementById('theme-light'),
            dark: document.getElementById('theme-dark'),
            system: document.getElementById('theme-system')
        };
        const osThemeQuery = window.matchMedia('(prefers-color-scheme: dark)');
        
        // --- Function to animate UI elements in ---
        function animateUIIn() {
            const topLeftUI = document.getElementById('top-left-ui');
            const dirBox = document.getElementById('directory-box');

            if (topLeftUI && dirBox) {
                 // Reset styles before animating
                 anime.set([topLeftUI, dirBox], {
                    opacity: 0,
                    translateY: 50 // Start below
                 });

                 // Animate in with bounce
                 anime({
                     targets: topLeftUI,
                     opacity: 1,
                     translateY: 0,
                     duration: 1200,
                     easing: 'easeOutElastic(1, .6)', // Elastic bounce
                     delay: 100 // Slight delay
                 });
                 anime({
                     targets: dirBox,
                     opacity: 1,
                     translateY: 0,
                     duration: 1200,
                     easing: 'easeOutElastic(1, .6)', // Elastic bounce
                     delay: 250 // Slightly later delay
                 });
            }
        }


        function applyTheme(theme) { // 'light', 'dark', or 'system'
            let effectiveTheme; // 'light' or 'dark'

            if (theme === 'system') {
                effectiveTheme = osThemeQuery.matches ? 'dark' : 'light';
                localStorage.removeItem('theme');
            } else {
                effectiveTheme = theme;
                localStorage.setItem('theme', theme);
            }

            // Apply to HTML tag for Tailwind
            if (effectiveTheme === 'dark') {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }

            // Update 3D scene
            updateSceneTheme(effectiveTheme);

            // Update ClickSpark color based on theme
            updateClickSparkColor();

            // Update button styles
            for (const key in themeButtons) {
                themeButtons[key].classList.remove('active');
            }
            themeButtons[theme].classList.add('active');
            
             // FIX: Call animateUIIn from here, which is now called on page load
             // *regardless* of 3D model status.
             // --- REMOVED: animateUIIn() call was moved to window.onload to prevent race condition ---
        }

        function updateSceneTheme(effectiveTheme) {
            if (!renderer) return; // Scene not initialized yet

            const config = themes[effectiveTheme];
            
            renderer.setClearColor(config.bgColor);
            if (ambientLight) ambientLight.intensity = config.ambientLight;
            if (directionalLight) directionalLight.intensity = config.directionalLight;

            // --- Model Swapping Logic ---
            if (effectiveTheme === 'dark') {
                // Show black hole
                if (starField) starField.visible = true;
                if (controls) {
                    controls.autoRotate = true;
                    controls.autoRotateSpeed = 0.8;
                    controls.minDistance = 1200;
                    controls.maxDistance = 10000;
                }
                
                if (isMacbookLoaded && activeModel === macbookModel) {
                    scene.remove(macbookModel);
                }
                if (isBlackHoleLoaded && activeModel !== blackHoleModel) {
                    scene.add(blackHoleModel);
                    activeModel = blackHoleModel;
                }

            } else {
                // Show macbook (light mode)
                if (starField) starField.visible = false;
                if (controls) {
                    controls.autoRotate = true; 
                    controls.autoRotateSpeed = 0.5; 
                    controls.minDistance = 1;
                    controls.maxDistance = 10;
                }

                if (isBlackHoleLoaded && activeModel === blackHoleModel) {
                    scene.remove(blackHoleModel);
                }
                if (isMacbookLoaded && activeModel !== macbookModel) {
                    scene.add(macbookModel);
                    activeModel = macbookModel;
                }
            }
        }
        
        themeButtons.light.addEventListener('click', () => applyTheme('light'));
        themeButtons.dark.addEventListener('click', () => applyTheme('dark'));
        themeButtons.system.addEventListener('click', () => applyTheme('system'));
        osThemeQuery.addEventListener('change', () => {
             // Re-apply if we are in system mode
            if (!localStorage.getItem('theme')) {
                applyTheme('system');
            }
        });

        // --- Draggable Box Logic ---
        function makeDraggable(element, handle) {
            let isDragging = false;
            let isDraggableLocked = false; // Start unlocked
            let offsetX = 0;
            let offsetY = 0;

            const lockButton = document.getElementById('drag-lock-btn');
            const lockIconPath = document.getElementById('lock-icon-path');
            const pathUnlock = "M18 9V7a4 4 0 00-8 0v2m8 0H6a2 2 0 00-2 2v6a2 2 0 002 2h12a2 2 0 002-2v-6a2 2 0 00-2-2z";
            const pathLock = "M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z";

            // Set initial state
            if (lockIconPath) lockIconPath.setAttribute('d', pathUnlock);
            if (handle) handle.style.cursor = 'grab';

            if (lockButton) {
                lockButton.addEventListener('click', (e) => {
                    e.stopPropagation(); // Prevent drag from starting
                    isDraggableLocked = !isDraggableLocked;
                    if (isDraggableLocked) {
                        lockIconPath.setAttribute('d', pathLock);
                        handle.style.cursor = 'default';
                    } else {
                        lockIconPath.setAttribute('d', pathUnlock);
                        handle.style.cursor = 'grab';
                    }
                });
            }

            if (handle) {
                handle.addEventListener('pointerdown', (e) => {
                    if (isDraggableLocked) return;
                    e.preventDefault(); 
                    isDragging = true;
                    
                    const rect = element.getBoundingClientRect();
                    offsetX = e.clientX - rect.left;
                    offsetY = e.clientY - rect.top;

                    element.classList.remove('bottom-16', 'right-8', 'md:right-16', 'lg:right-32');

                    element.style.left = `${rect.left}px`;
                    element.style.top = `${rect.top}px`;

                    handle.style.cursor = 'grabbing';
                });
            }

            window.addEventListener('pointermove', (e) => {
                if (!isDragging) return;

                let newX = e.clientX - offsetX;
                let newY = e.clientY - offsetY;

                const elRect = element.getBoundingClientRect();
                const maxW = window.innerWidth - elRect.width;
                const maxH = window.innerHeight - elRect.height;

                if (newX < 0) newX = 0;
                if (newY < 0) newY = 0;
                if (newX > maxW) newX = maxW;
                if (newY > maxH) newY = maxH; 
                
                element.style.left = `${newX}px`;
                element.style.top = `${newY}px`;
            });

            window.addEventListener('pointerup', () => {
                isDragging = false;
                if (handle && !isDraggableLocked) {
                    handle.style.cursor = 'grab';
                }
            });
        }
        
        const directoryBox = document.getElementById('directory-box');
        const directoryHandle = document.getElementById('directory-handle');
        if (directoryBox && directoryHandle) {
            makeDraggable(directoryBox, directoryHandle);
        }
        

        // --- 3D Scene Initialization ---
        function init() {
            scene = new THREE.Scene();

            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 50000);
            camera.position.z = 150; 

            renderer = new THREE.WebGLRenderer({ 
                antialias: !isMobileDevice(), // Disable antialiasing on mobile for performance
                alpha: true,
                powerPreference: isMobileDevice() ? 'low-power' : 'high-performance'
            }); 
            renderer.setSize(window.innerWidth, window.innerHeight);
            
            // OPTIMIZATION: Cap pixel ratio at 2 for performance, 1 for mobile
            renderer.setPixelRatio(Math.min(window.devicePixelRatio, isMobileDevice() ? 1 : 2)); 
            
            container.appendChild(renderer.domElement);

            // --- Lighting ---
            ambientLight = new THREE.AmbientLight(0xffffff, 0.5); 
            scene.add(ambientLight);
            
            directionalLight = new THREE.DirectionalLight(0xffffff, 1); 
            directionalLight.position.set(5, 10, 7.5);
            scene.add(directionalLight);

            // --- 3D Model Loader (Black Hole) ---
            const loader = new GLTFLoader();
            // --- Corrected path for local host and published site ---
            // FIX: Use the Git LFS raw media URL
            const modelUrl = 'https://media.githubusercontent.com/media/itzmedaniel/website/main/black_hole.glb'; 

            loader.load(modelUrl, (gltf) => {
                blackHoleModel = gltf.scene;
                
                blackHoleModel.traverse((child) => {
                    if (child.isMesh && child.material) {
                        if (child.material.map) {
                            child.material.transparent = true;
                            child.material.depthWrite = false;
                            child.material.blending = THREE.NormalBlending; 
                            child.material.needsUpdate = true;
                        }
                    }
                });
                
                blackHoleModel.scale.set(1, 1, 1); 
                new THREE.Box3().setFromObject(blackHoleModel).getCenter(blackHoleModel.position).multiplyScalar(-1);
                
                // --- UPDATED: Don't add to scene immediately ---
                // scene.add(blackHoleModel);
                // activeModel = blackHoleModel;
                isBlackHoleLoaded = true;
                
                // --- THEME BUG FIX ---
                // Check if the theme logic should be run now
                if (isMacbookLoaded) {
                    triggerInitialTheme();
                }

            }, undefined, (error) => {
                console.error('An error happened while loading the black hole model:', error);
                // Display error message if model fails to load
                if (container && container.children.length === 0) {
                     container.innerHTML = '<div class="absolute inset-0 z-10 flex items-center justify-center text-center text-red-500">Failed to load 3D model (black_hole.glb). Check console for details.</div>';
                }
            });

            // --- 3D Model Loader (Macbook) ---
            const macbookLoader = new GLTFLoader();
            // --- Corrected path for local host and published site ---
            // FIX: Use the Git LFS raw media URL
            const macbookModelUrl = 'https://media.githubusercontent.com/media/itzmedaniel/website/main/macbook.glb'; 

            macbookLoader.load(macbookModelUrl, (gltf) => {
                macbookModel = gltf.scene;
                
                macbookModel.scale.set(10, 10, 10); 
                new THREE.Box3().setFromObject(macbookModel).getCenter(macbookModel.position).multiplyScalar(-1);
                
                isMacbookLoaded = true;
                
                // --- THEME BUG FIX ---
                // Check if the theme logic should be run now
                if (isBlackHoleLoaded) {
                    triggerInitialTheme();
                }

            }, undefined, (error) => {
                console.error('An error happened while loading the macbook model:', error);
                // NEW: Add a specific error message for the macbook model
                if (container && !isMacbookLoaded) {
                     container.insertAdjacentHTML('beforeend', '<div class="absolute z-10 flex items-center justify-center text-center text-red-500 -translate-x-1/2 -translate-y-1/2 top-1/2 left-1/2">Failed to load macbook.glb.</div>');
                }
            });


            // --- Starfield Background ---
            const starVertices = [];
            // OPTIMIZED: Reduced stars based on device type
            const starCount = isMobileDevice() ? 2000 : 5000;
            for (let i = 0; i < starCount; i++) {
                const x = THREE.MathUtils.randFloatSpread(20000);
                const y = THREE.MathUtils.randFloatSpread(20000);
                const z = THREE.MathUtils.randFloatSpread(20000);
                starVertices.push(x, y, z);
            }
            const starGeometry = new THREE.BufferGeometry();
            starGeometry.setAttribute('position', new THREE.Float32BufferAttribute(starVertices, 3));
            const starMaterial = new THREE.PointsMaterial({
                 color: 0xffffff,
                 size: isMobileDevice() ? 2 : 2.5,
                 transparent: true,
                 opacity: 0.8,
                 sizeAttenuation: false // OPTIMIZED: Disable size attenuation for performance
            });
            starField = new THREE.Points(starGeometry, starMaterial);
            scene.add(starField);

            // --- Controls ---
            controls = new OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true; 
            controls.dampingFactor = 0.05;
            controls.enableZoom = true; 
            controls.autoRotate = true; 
            controls.autoRotateSpeed = isMobileDevice() ? 0.5 : 0.8; // Slower rotation on mobile
            controls.enablePan = false; // OPTIMIZED: Disable panning
            controls.minDistance = 5; // OPTIMIZED: Limit zoom distance
            controls.maxDistance = 50; // OPTIMIZED: Limit zoom distance
            
            // Touch-specific optimizations - enable touch controls for mobile dragging
            if (isMobileDevice()) {
                controls.rotateSpeed = 0.5; // Slower rotation on mobile
                controls.zoomSpeed = 0.8;
                controls.touches = {
                    ONE: THREE.TOUCH.ROTATE,
                    TWO: THREE.TOUCH.DOLLY_PAN
                };
            }
            
            // Explicitly enable touch events
            renderer.domElement.style.touchAction = 'none';
            
            // --- Event Listeners ---
            window.addEventListener('resize', onWindowResize);
            
        } // End of init()
        
        // --- THEME BUG FIX ---
        // This function applies the theme *after* both models are loaded
        let initialThemeApplied = false;
        function triggerInitialTheme() {
            if (initialThemeApplied) return; // Only run once
            initialThemeApplied = true;
            
            // Now, apply the theme which will also show the correct model
            const savedTheme = localStorage.getItem('theme') || 'system';
            applyTheme(savedTheme);
            
            // Now it's safe to animate the UI
            animateUIIn();
        }
        // --- END THEME BUG FIX ---

        function onWindowResize() {
            if (camera) {
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
            }
            if (renderer) {
                renderer.setSize(window.innerWidth, window.innerHeight);
                // Re-apply pixel ratio cap on resize
                renderer.setPixelRatio(Math.min(window.devicePixelRatio, isMobileDevice() ? 1 : 2));
            }
        }

        // Mobile device detection helper
        function isMobileDevice() {
            return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) 
                || window.innerWidth <= 768;
        }

        function animate() {
            animationFrameId = requestAnimationFrame(animate);

            if (controls) {
                controls.update();
            }

            // OPTIMIZED: Reduce starfield rotation speed and only update if visible
            // Further reduced on mobile devices
            if (starField && starField.visible) {
                starField.rotation.y += isMobileDevice() ? 0.00003 : 0.00005;
            }
            
            if (renderer && scene && camera) {
                renderer.render(scene, camera);
            }
        }

        // --- Navigation Logic ---
        const mainContent = document.getElementById('main-content');
        const homeButton = document.getElementById('home-button');
        
        const pages = {
            aboutMe: document.getElementById('about-me-page'),
            project: document.getElementById('project-page'),
            contact: document.getElementById('contact-page'),
            reference: document.getElementById('reference-page')
        };
        const links = {
            aboutMe: document.getElementById('about-me-link'),
            project: document.getElementById('project-link'),
            contact: document.getElementById('contact-link'),
            reference: document.getElementById('reference-link')
        };
// daniel
// long
        let activePageElement = null; // Track the currently visible page
        let currentPageIndex = -1; // -1 = home, 0 = aboutMe, 1 = project, 2 = contact, 3 = reference
        const pageOrder = ['aboutMe', 'project', 'contact', 'reference'];
        let isAnimating = false; // Prevent multiple scroll triggers during animation
        let scrollTimeout = null;

        function showHomePage() {
            // Fade out nav
            const navContainer = document.querySelector('.card-nav-container');
            if (navContainer) {
                anime({
                    targets: navContainer,
                    opacity: 0,
                    duration: 200,
                    easing: 'easeInQuad'
                });
            }
            
            // Use transition if coming from a page
            if (activePageElement) {
                transitionToHome();
            } else {
                // Direct show if already on home
                if (mainContent) mainContent.classList.remove('hidden');
                if (homeButton) homeButton.classList.add('hidden');
                Object.values(pages).forEach(page => {
                    if (page) page.classList.add('hidden');
                });
                activePageElement = null;
                currentPageIndex = -1;
                
                // Add on-home class to body
                document.body.classList.add('on-home');
                
                // Clean up
                Object.values(panelAnimationInstances).forEach(instance => {
                    if (instance) instance.pause();
                });
                Object.keys(pages).forEach(pageId => {
                    if (!pages[pageId]) return;
                    if (headingAnimationInstances[pageId]) {
                        anime.remove(headingAnimationInstances[pageId].targets);
                        delete headingAnimationInstances[pageId];
                    }
                });
                
                // Hide all backgrounds (don't destroy them)
                hideAllBackgrounds();

                animateUIIn();
                stopBouncingLogo();
                
                // Restart 3D animation
                if (!animationFrameId) {
                    animate();
                }
                
                // Fade in nav after home loads
                if (navContainer) {
                    anime({
                        targets: navContainer,
                        opacity: 1,
                        duration: 400,
                        delay: 200,
                        easing: 'easeOutQuad'
                    });
                }
            }
        }
        
        // Make showHomePage globally accessible
        window.showHomePage = showHomePage;

        function showPage(pageId) {
             if (mainContent) mainContent.classList.add('hidden');
             if (homeButton) homeButton.classList.remove('hidden');
             
             // Remove on-home class from body
             document.body.classList.remove('on-home');
             
             // Fade out nav
             const navContainer = document.querySelector('.card-nav-container');
             if (navContainer) {
                 anime({
                     targets: navContainer,
                     opacity: 0,
                     duration: 200,
                     easing: 'easeInQuad'
                 });
             }
             
             // Find the index of the page
             currentPageIndex = pageOrder.indexOf(pageId);
             
             // Hide all pages first
             Object.values(pages).forEach(page => {
                 if (page) page.classList.add('hidden');
            });
             // Show the requested page
             const currentPageElement = pages[pageId];
             if (!currentPageElement) return;

             activePageElement = currentPageElement; // Store the active page element
             currentPageElement.classList.remove('hidden');
             currentPageElement.scrollTop = 0; // Scroll to top

             // Stop 3D animation
             if (animationFrameId) {
                 cancelAnimationFrame(animationFrameId);
                 animationFrameId = null;
             }
             
             // Initialize background for current page
             initPageBackground(pageId);
             
             // --- NEW: Page entrance animation ---
             const glassPanel = currentPageElement.querySelector('.glass-panel');
             if (glassPanel) {
                 anime.set(glassPanel, { opacity: 0, translateY: 20 }); // Start slightly below
                 anime({
                     targets: glassPanel,
                     opacity: 1,
                     translateY: 0,
                     duration: 800,
                     easing: 'easeOutSine',
                     // Chain continuous hover animation to the end of the entrance animation
                     complete: function() {
                         animateContinuousHover(pageId); 
                     }
                 });
             }
             
             // --- Run the Character Slide animation (Replacing the old line-clip/color-wave) ---
             animateHeadingCharSlide(pageId);
             
             // --- UPDATED: Start bouncing logo for ALL pages ---
             startBouncingLogo();
             
             // Fade in nav after page loads
             if (navContainer) {
                 anime({
                     targets: navContainer,
                     opacity: 1,
                     duration: 400,
                     delay: 200,
                     easing: 'easeOutQuad'
                 });
             }
             
             // --- NEW: Add wheel event listener for page scrolling ---
             addPageScrollListener(currentPageElement);
             
             // Initialize navigation scroll animation
             initNavScrollAnimation();
        }
        
        // Make showPage globally accessible
        window.showPage = showPage;
        
        // NEW: Function to initialize background for a specific page
        function initPageBackground(pageId) {
            console.log('Initializing background for:', pageId);
            
            // First, hide all backgrounds
            hideAllBackgrounds();
            
            // Lazy initialization - only init the background that's needed
            const initMap = {
                'aboutMe': () => { 
                    console.log('Checking plasmaInstance:', plasmaInstance);
                    if (!plasmaInstance) {
                        console.log('Initializing Plasma...');
                        // Wait for script to load
                        if (typeof Plasma === 'undefined') {
                            console.warn('Plasma class not loaded yet, retrying...');
                            setTimeout(() => initPageBackground(pageId), 100);
                            return;
                        }
                        // Make container visible and wait for layout
                        const container = document.getElementById('plasma-bg-aboutme');
                        if (container) {
                            container.style.visibility = 'visible';
                            container.style.opacity = '1';
                            container.style.zIndex = '1';
                            requestAnimationFrame(() => {
                                initPlasma();
                            });
                        } else {
                            initPlasma();
                        }
                    } else {
                        // Already initialized, just show it
                        showBackgroundForPage(pageId);
                    }
                },
                'project': () => { 
                    console.log('Checking terminalInstance:', terminalInstance);
                    if (!terminalInstance) {
                        console.log('Initializing FaultyTerminal...');
                        // Wait for script to load
                        if (typeof FaultyTerminal === 'undefined') {
                            console.warn('FaultyTerminal class not loaded yet, retrying...');
                            setTimeout(() => initPageBackground(pageId), 100);
                            return;
                        }
                        // Make container visible and wait for layout
                        const container = document.getElementById('terminal-bg-project');
                        if (container) {
                            container.style.visibility = 'visible';
                            container.style.opacity = '1';
                            container.style.zIndex = '1';
                            requestAnimationFrame(() => {
                                initFaultyTerminal();
                            });
                        } else {
                            initFaultyTerminal();
                        }
                    } else {
                        // Already initialized, just show it
                        showBackgroundForPage(pageId);
                    }
                },
                'contact': () => { 
                    console.log('Checking liquidChromeInstance:', liquidChromeInstance);
                    if (!liquidChromeInstance) {
                        console.log('Initializing LiquidChrome...');
                        // Wait for script to load
                        if (typeof LiquidChrome === 'undefined') {
                            console.warn('LiquidChrome class not loaded yet, retrying...');
                            setTimeout(() => initPageBackground(pageId), 100);
                            return;
                        }
                        // Make container visible and wait for layout
                        const container = document.getElementById('liquid-chrome-bg-contact');
                        if (container) {
                            container.style.visibility = 'visible';
                            container.style.opacity = '1';
                            container.style.zIndex = '1';
                            requestAnimationFrame(() => {
                                initLiquidChrome();
                            });
                        } else {
                            initLiquidChrome();
                        }
                    } else {
                        // Already initialized, just show it
                        showBackgroundForPage(pageId);
                    }
                },
                'reference': () => { 
                    console.log('Checking letterGlitchInstance:', letterGlitchInstance);
                    
                    // FIXED: Always destroy and recreate to ensure proper sizing
                    if (letterGlitchInstance) {
                        console.log('Destroying existing LetterGlitch instance...');
                        try {
                            letterGlitchInstance.destroy();
                        } catch(e) {
                            console.error('Error destroying LetterGlitch:', e);
                        }
                        letterGlitchInstance = null;
                    }
                    
                    console.log('Initializing LetterGlitch...');
                    // Wait for script to load
                    if (typeof LetterGlitch === 'undefined') {
                        console.warn('LetterGlitch class not loaded yet, retrying...');
                        setTimeout(() => initPageBackground(pageId), 100);
                        return;
                    }
                    // Make container visible and wait for layout
                    const container = document.getElementById('letter-glitch-bg-reference');
                    if (container) {
                        container.style.visibility = 'visible';
                        container.style.opacity = '1';
                        container.style.zIndex = '1';
                        requestAnimationFrame(() => {
                            initLetterGlitch();
                        });
                    } else {
                        initLetterGlitch();
                    }
                }
            };
            
            // Initialize the background for this page if init function exists
            if (initMap[pageId]) {
                initMap[pageId]();
            } else {
                // If already initialized, just show it
                showBackgroundForPage(pageId);
            }
        }
        
        // NEW: Hide all backgrounds
        function hideAllBackgrounds() {
            const plasmaContainer = document.getElementById('plasma-bg-aboutme');
            const terminalContainer = document.getElementById('terminal-bg-project');
            const liquidContainer = document.getElementById('liquid-chrome-bg-contact');
            const letterContainer = document.getElementById('letter-glitch-bg-reference');
            
            // Use opacity and z-index instead of display: none to preserve WebGL context
            if (plasmaContainer) {
                plasmaContainer.style.opacity = '0';
                plasmaContainer.style.zIndex = '-10';
                plasmaContainer.style.pointerEvents = 'none';
                plasmaContainer.style.visibility = 'hidden';
            }
            if (terminalContainer) {
                terminalContainer.style.opacity = '0';
                terminalContainer.style.zIndex = '-10';
                terminalContainer.style.pointerEvents = 'none';
                terminalContainer.style.visibility = 'hidden';
            }
            if (liquidContainer) {
                liquidContainer.style.opacity = '0';
                liquidContainer.style.zIndex = '-10';
                liquidContainer.style.pointerEvents = 'none';
                liquidContainer.style.visibility = 'hidden';
            }
            if (letterContainer) {
                letterContainer.style.opacity = '0';
                letterContainer.style.zIndex = '-10';
                letterContainer.style.pointerEvents = 'none';
                letterContainer.style.visibility = 'hidden';
            }
            
            // OPTIMIZED: Pause animations for hidden backgrounds
            if (plasmaInstance && plasmaInstance.pause) plasmaInstance.pause();
            if (terminalInstance && terminalInstance.pause) terminalInstance.pause();
            if (liquidChromeInstance && liquidChromeInstance.pause) liquidChromeInstance.pause();
            if (letterGlitchInstance && letterGlitchInstance.pause) letterGlitchInstance.pause();
        }
        
        // NEW: Show background for specific page
        function showBackgroundForPage(pageId) {
            const backgrounds = {
                'aboutMe': 'plasma-bg-aboutme',
                'project': 'terminal-bg-project',
                'contact': 'liquid-chrome-bg-contact',
                'reference': 'letter-glitch-bg-reference'
            };
            
            const containerId = backgrounds[pageId];
            console.log('showBackgroundForPage called for:', pageId, 'containerId:', containerId);
            if (containerId) {
                const container = document.getElementById(containerId);
                console.log('Container element:', container);
                if (container) {
                    // Use opacity and z-index instead of display
                    container.style.opacity = '1';
                    container.style.zIndex = '1';
                    container.style.visibility = 'visible';
                    container.style.pointerEvents = 'none'; // Don't block clicks
                    console.log('Background shown:', containerId, 'Opacity:', container.style.opacity);
                    
                    // OPTIMIZED: Resume animation for the active background
                    if (pageId === 'aboutMe' && plasmaInstance && plasmaInstance.resume) plasmaInstance.resume();
                    if (pageId === 'project' && terminalInstance && terminalInstance.resume) terminalInstance.resume();
                    if (pageId === 'contact' && liquidChromeInstance && liquidChromeInstance.resume) liquidChromeInstance.resume();
                    if (pageId === 'reference' && letterGlitchInstance && letterGlitchInstance.resume) letterGlitchInstance.resume();
                    
                    // FIXED: Trigger resize for LetterGlitch when showing - use double RAF
                    if (pageId === 'reference' && letterGlitchInstance) {
                        console.log('Triggering LetterGlitch resize...');
                        // Wait for container to be fully visible
                        requestAnimationFrame(() => {
                            requestAnimationFrame(() => {
                                if (letterGlitchInstance && letterGlitchInstance.resizeCanvas) {
                                    console.log('Calling resizeCanvas...');
                                    letterGlitchInstance.resizeCanvas();
                                }
                            });
                        });
                    }
                } else {
                    console.error('Container not found:', containerId);
                }
            }
        }
        
        // NEW: Add scroll listener to page for navigation
        function addPageScrollListener(pageElement) {
            if (!pageElement) return;
            
            // Store bound function for proper removal
            if (!pageElement._scrollHandler) {
                pageElement._scrollHandler = function(e) {
                    handlePageScroll(e, pageElement);
                };
            }
            
            // Remove existing listener if any
            pageElement.removeEventListener('wheel', pageElement._scrollHandler);
            
            // Add new listener
            pageElement.addEventListener('wheel', pageElement._scrollHandler, { passive: false });
        }
        
        // NEW: Handle scroll within pages to navigate between them
        function handlePageScroll(e, pageElement) {
            if (isAnimating) {
                e.preventDefault();
                return;
            }
            
            const scrollTop = pageElement.scrollTop;
            const scrollHeight = pageElement.scrollHeight;
            const clientHeight = pageElement.clientHeight;
            
            const isAtTop = scrollTop <= 1; // Small threshold for top
            const isAtBottom = scrollTop + clientHeight >= scrollHeight - 1; // Small threshold for bottom
            
            console.log('Scroll event:', {
                deltaY: e.deltaY,
                scrollTop,
                scrollHeight,
                clientHeight,
                isAtTop,
                isAtBottom,
                currentPage: pageOrder[currentPageIndex]
            });
            
            // Scrolling down at bottom → go to next page
            if (e.deltaY > 0 && isAtBottom) {
                e.preventDefault();
                console.log('Attempting to go to next page from', pageOrder[currentPageIndex]);
                goToNextPage();
            }
            // Scrolling up at top → go to previous page
            else if (e.deltaY < 0 && isAtTop) {
                e.preventDefault();
                console.log('Attempting to go to previous page from', pageOrder[currentPageIndex]);
                goToPreviousPage();
            }
        }
        
        // NEW: Navigate to next page
        function goToNextPage() {
            if (currentPageIndex < pageOrder.length - 1) {
                const nextPageId = pageOrder[currentPageIndex + 1];
                transitionToPage(nextPageId, 'down');
            }
        }
        
        // NEW: Navigate to previous page
        function goToPreviousPage() {
            if (currentPageIndex > 0) {
                const prevPageId = pageOrder[currentPageIndex - 1];
                transitionToPage(prevPageId, 'up');
            } else {
                // If at first page, go back to home
                transitionToHome();
            }
        }
        
        // NEW: Transition to another page with animation
        function transitionToPage(newPageId, direction) {
            if (isAnimating) return;
            isAnimating = true;
            
            const oldPageElement = activePageElement;
            const newPageElement = pages[newPageId];
            
            if (!newPageElement) {
                isAnimating = false;
                return;
            }
            
            // Fade out nav
            const navContainer = document.querySelector('.card-nav-container');
            if (navContainer) {
                anime({
                    targets: navContainer,
                    opacity: 0,
                    duration: 200,
                    easing: 'easeInQuad'
                });
            }
            
            // Ensure home button is visible
            if (homeButton) homeButton.classList.remove('hidden');
            
            // IMPORTANT: Initialize background BEFORE showing the page
            initPageBackground(newPageId);
            
            // Remove scroll listener from old page
            if (oldPageElement && oldPageElement._scrollHandler) {
                oldPageElement.removeEventListener('wheel', oldPageElement._scrollHandler);
            }
            
            // Animate out old page
            const translateYOut = direction === 'down' ? '-100%' : '100%';
            anime({
                targets: oldPageElement,
                translateY: translateYOut,
                opacity: 0,
                duration: 600,
                easing: 'easeInOutQuad',
                complete: function() {
                    oldPageElement.classList.add('hidden');
                    anime.set(oldPageElement, { translateY: 0, opacity: 1 });
                }
            });
            
            // Show and animate in new page
            const translateYStart = direction === 'down' ? '100%' : '-100%';
            newPageElement.classList.remove('hidden');
            newPageElement.scrollTop = 0; // Reset scroll position
            activePageElement = newPageElement;
            currentPageIndex = pageOrder.indexOf(newPageId);
            
            // Animate glass panel entrance
            const glassPanel = newPageElement.querySelector('.glass-panel');
            if (glassPanel) {
                anime.set(glassPanel, { opacity: 0, translateY: 20 });
            }
            
            anime.set(newPageElement, { translateY: translateYStart, opacity: 0 });
            anime({
                targets: newPageElement,
                translateY: 0,
                opacity: 1,
                duration: 600,
                easing: 'easeInOutQuad',
                complete: function() {
                    isAnimating = false;
                    
                    // FIXED: Additional resize for LetterGlitch after animation completes
                    if (newPageId === 'reference' && letterGlitchInstance) {
                        setTimeout(() => {
                            if (letterGlitchInstance && letterGlitchInstance.resizeCanvas) {
                                console.log('Post-animation LetterGlitch resize...');
                                letterGlitchInstance.resizeCanvas();
                            }
                        }, 100);
                    }
                    
                    // Animate glass panel after page slides in
                    if (glassPanel) {
                        anime({
                            targets: glassPanel,
                            opacity: 1,
                            translateY: 0,
                            duration: 600,
                            easing: 'easeOutSine',
                            complete: function() {
                                animateContinuousHover(newPageId);
                            }
                        });
                    }
                    
                    // Run heading animation
                    animateHeadingCharSlide(newPageId);
                    
                    // Start bouncing logo
                    startBouncingLogo();
                    
                    // Fade in nav after page loads
                    const navContainer = document.querySelector('.card-nav-container');
                    if (navContainer) {
                        anime({
                            targets: navContainer,
                            opacity: 1,
                            duration: 400,
                            delay: 200,
                            easing: 'easeOutQuad'
                        });
                    }
                    
                    // Add scroll listener to new page
                    setTimeout(() => {
                        addPageScrollListener(newPageElement);
                        console.log('Scroll listener added to', newPageId);
                    }, 100);
                }
            });
        }
        
        // NEW: Transition back to home
        function transitionToHome() {
            if (isAnimating) return;
            isAnimating = true;
            
            const oldPageElement = activePageElement;
            
            // Animate out current page
            anime({
                targets: oldPageElement,
                translateY: '100%',
                opacity: 0,
                duration: 600,
                easing: 'easeInOutQuad',
                complete: function() {
                    oldPageElement.classList.add('hidden');
                    anime.set(oldPageElement, { translateY: 0, opacity: 1 });
                    
                    // Show home page
                    if (mainContent) mainContent.classList.remove('hidden');
                    if (homeButton) homeButton.classList.add('hidden');
                    activePageElement = null;
                    currentPageIndex = -1;
                    
                    // Add on-home class to body
                    document.body.classList.add('on-home');
                    
                    // Clean up
                    Object.values(panelAnimationInstances).forEach(instance => {
                        if (instance) instance.pause();
                    });
                    Object.keys(pages).forEach(pageId => {
                        if (!pages[pageId]) return;
                        if (headingAnimationInstances[pageId]) {
                            anime.remove(headingAnimationInstances[pageId].targets);
                            delete headingAnimationInstances[pageId];
                        }
                    });
                    
                    // Hide all backgrounds (don't destroy them)
                    hideAllBackgrounds();
                    
                    stopBouncingLogo();
                    animateUIIn();
                    
                    // Fade in nav after home loads
                    const navContainer = document.querySelector('.card-nav-container');
                    if (navContainer) {
                        anime({
                            targets: navContainer,
                            opacity: 1,
                            duration: 400,
                            delay: 200,
                            easing: 'easeOutQuad'
                        });
                    }
                    
                    // Restart 3D animation
                    if (!animationFrameId) {
                        animate();
                    }
                    
                    isAnimating = false;
                }
            });
        }

        if(links.aboutMe) links.aboutMe.addEventListener('click', () => showPage('aboutMe'));
        if(links.project) links.project.addEventListener('click', () => showPage('project'));
        if(links.contact) links.contact.addEventListener('click', () => showPage('contact'));
        if(links.reference) links.reference.addEventListener('click', () => showPage('reference'));
        if(homeButton) homeButton.addEventListener('click', showHomePage);

        // --- Continuous Hover Animation Logic ---
        let panelAnimationInstances = {};

        function animateContinuousHover(pageId) {
            const orbElement = document.getElementById(`orb-${pageId}`);
            if (!orbElement) return;

            // Stop any existing animation on this panel
            if (panelAnimationInstances[pageId]) {
                 panelAnimationInstances[pageId].pause();
            }
            
            // Apply the continuous float/hover effect to the ORB
            panelAnimationInstances[pageId] = anime({
                 targets: orbElement,
                 translateX: [
                     { value: anime.random(-300, 300), duration: 7000, easing: 'easeInOutQuad' },
                     { value: anime.random(-300, 300), duration: 6000, easing: 'easeInOutSine' },
                     { value: anime.random(-300, 300), duration: 8000, easing: 'easeInOutExpo' }
                 ],
                 translateY: [
                     { value: anime.random(-300, 300), duration: 7500, easing: 'easeInOutSine' },
                     { value: anime.random(-300, 300), duration: 6500, easing: 'easeInOutQuad' },
                     { value: anime.random(-300, 300), duration: 5500, easing: 'easeInOutExpo' }
                 ],
                 scale: [
                     { value: 1.2, duration: 4000, easing: 'easeInOutSine' },
                     { value: 0.8, duration: 4000, easing: 'easeInOutSine' }
                 ],
                 duration: 8000,
                 direction: 'alternate',
                 loop: true
            });
        }
        
        // --- Directory Heading Character Slide Animation ---
        let headingAnimationInstances = {};

        function animateHeadingCharSlide(pageId) {
            const pageElement = pages[pageId];
            if (!pageElement) return;
            const heading = pageElement.querySelector('h1.animated-heading');
            if (!heading) return;

            // 1. Clean slate: Remove previous targets and animation
            if (headingAnimationInstances[pageId]) {
                 anime.remove(headingAnimationInstances[pageId].targets);
                 delete headingAnimationInstances[pageId];
            }
            anime.remove(heading);


            // Restore original text
            if (!heading.originalText) {
                heading.originalText = heading.textContent.trim();
            } else {
                heading.innerHTML = heading.originalText;
            }
            heading.classList.remove('split-applied'); 
            

            // 2. Split text by character, wrapping with 'clip' (mimicking requested structure)
            const text = heading.textContent;
            heading.innerHTML = text.replace(/\S/g, char => {
                // Use a space for space characters to maintain layout
                if (char.trim() === '') return ' ';
                return `<span class="anime-char-wrap"><span class="anime-char">${char}</span></span>`;
            });
            
            // 3. Apply the requested character slide animation
            const targets = heading.querySelectorAll('.anime-char');
            if (targets.length === 0) return; // No characters to animate
            
            headingAnimationInstances[pageId] = anime({
                targets: targets,
                translateY: [
                     // Slide in from 100% (bottom) to 0% (natural position)
                    { value: ['100%', '0%'], duration: 750, easing: 'easeOutExpo' }, 
                     // Slide out from 0% to -100% (top)
                    { value: '-100%', delay: 750, duration: 750, easing: 'easeInExpo' } 
                ],
                delay: anime.stagger(50),
                loop: true,
                loopDelay: 500,
                // Ensures targets start off-screen before the loop begins
                begin: function(anim) {
                    anime.set(targets, { translateY: '100%' });
                },
                // Re-set position at the beginning of each loop for continuity
                loopBegin: function(anim) {
                    anime.set(targets, { translateY: '100%' });
                }
            });
            
            heading.classList.add('split-applied');
        }
        
        // --- OPTIMIZATION: Removed JS-based animateShine() function ---
        
        
        // --- START: Bouncing Logo Logic ---
        let logo = null; // Will be set to the active page's logo
        let x = 100; // Initial X
        let y = 100; // Initial Y
        // UPDATED: Changed speed to 1.5
        let vx = 1.5;  // Speed X
        let vy = 1.5;  // Speed Y
        let rotation = 0; // NEW: Add rotation variable
        let logoAnimationId = null;

        function animateLogo() {
            if (!logo) return; // Guard against missing element
            const bounds = document.body.getBoundingClientRect();
            const logoWidth = logo.offsetWidth; // Use offsetWidth for layout size
            const logoHeight = logo.offsetHeight;
            
            x += vx;
            y += vy;
            rotation += 2; // NEW: Increment rotation for spinning effect

            // Bounce logic
            if (x + logoWidth > bounds.width) {
                x = bounds.width - logoWidth;
                vx *= -1;
            }
            if (x < 0) {
                x = 0;
                vx *= -1;
            }
            if (y + logoHeight > bounds.height) {
                y = bounds.height - logoHeight;
                vy *= -1;
            }
            if (y < 0) {
                y = 0;
                vy *= -1;
            }

            // Use translate for performance
            // UPDATED: Add rotate() to the transform
            logo.style.transform = `translate(${x}px, ${y}px) rotate(${rotation}deg)`; 
            
            logoAnimationId = requestAnimationFrame(animateLogo);
        }
        
        function startBouncingLogo() {
             // Get the logo from the currently active page
             if (activePageElement) {
                 logo = activePageElement.querySelector('.bouncing-logo-element');
             }
             console.log('startBouncingLogo called, logo element:', logo);
             if (logo) {
                logo.style.display = 'block';
                logo.style.visibility = 'visible';
                console.log('Logo display set to block, visibility:', logo.style.visibility);
             }
             if (!logoAnimationId && logo) {
                 // Reset position - clamp to visible area
                 const maxX = window.innerWidth - 100;
                 const maxY = window.innerHeight - 100;
                 // Keep logo in center 60% of screen to avoid edges
                 x = Math.random() * (maxX * 0.6) + (maxX * 0.2);
                 y = Math.random() * (maxY * 0.6) + (maxY * 0.2);
                 // Reset speed
                 vx = (Math.random() > 0.5 ? 1 : -1) * 1.5; // UPDATED: Speed 1.5
                 vy = (Math.random() > 0.5 ? 1 : -1) * 1.5; // UPDATED: Speed 1.5
                 
                 // Set initial transform before starting animation
                 if (logo) {
                    // UPDATED: Add rotate() to the initial transform
                    rotation = 0; // Reset rotation
                    logo.style.transform = `translate(${x}px, ${y}px) rotate(0deg)`;
                    console.log('Logo initial position:', x, y, 'Window size:', window.innerWidth, 'x', window.innerHeight);
                 }
                 animateLogo();
             }
        }
        
        function stopBouncingLogo() {
            if (logo) logo.style.display = 'none';
            if (logoAnimationId) {
                cancelAnimationFrame(logoAnimationId);
                logoAnimationId = null;
            }
        }
        // --- END: Bouncing Logo Logic ---


        // --- Main Execution ---
        
        // --- COPYRIGHT PROTECTION: Console Warning ---
        console.log('%c⚠️ COPYRIGHT WARNING ⚠️', 'color: #ff0000; font-size: 24px; font-weight: bold;');
        console.log('%c© 2025 Daniel Long - All Rights Reserved', 'color: #ff6600; font-size: 16px; font-weight: bold;');
        console.log('%cThis website\'s code and design are protected by copyright.', 'color: #ffffff; font-size: 14px;');
        console.log('%cUnauthorized copying or use is strictly prohibited.', 'color: #ffffff; font-size: 14px;');
        console.log('%cContact: daniellong1109@gmail.com for licensing inquiries.', 'color: #00ff00; font-size: 12px;');
        console.log('%c━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━', 'color: #666666;');
        
        // --- REMOVED: Right-click and keyboard shortcuts protection for development ---
        // (Re-enable in production if needed)
        
        // --- SYNCHRONIZATION POINT ---
        window.addEventListener('load', () => {
             init();
             animate(); // Start 3D animation loop
             
             // Load all background scripts at once
             console.log('Loading all background scripts...');
             loadFaultyTerminalScript();
             loadLetterGlitchScript();
             loadPlasmaScript();
             loadLiquidChromeScript();
             loadClickSparkScript(); // Load click spark effect
             loadMetallicPaintScript(); // Load metallic paint then card navigation
             
             // Time and Weather setup moved here
             updateTime(); 
             setInterval(updateTime, 60000); // Update time every minute
             
             fetchWeather(); // Fetch weather on load
             setInterval(fetchWeather, 120000); // UPDATED: Re-fetch weather every 2 minutes
             
             // Initialize Rain Radar
             initRainRadar();

             // --- THEME BUG FIX ---
             // UI animations are now called from triggerInitialTheme() after models are loaded
             // const savedTheme = localStorage.getItem('theme') || 'system';
             // applyTheme(savedTheme); // This is now called from triggerInitialTheme
            
             // --- OPTIMIZATION: Removed call to JS-based animateShine() ---
             setTimeout(animateWord, 500);
             // --- END NEW LOCATION ---
             
             // --- REMOVED: GEMINI API EVENT LISTENERS ---
             // setupGeminiListeners();
        });


        // --- anime.js Subtitle Animation (Remains the same) ---
        const words = [
            'HTML.',
            'JavaScript.',
            'anime.js.',
            'Three.js.',
            'Tailwind CSS.'
        ];
        let wordIndex = 0;
        let animationTimeout;

        function animateWord() {
            const textWrapper = document.getElementById('anime-text-target'); 
            clearTimeout(animationTimeout); 
            if (!textWrapper) return; 
            
            const word = words[wordIndex];
            
            // Wrap letters in spans
            textWrapper.innerHTML = word.replace(/\S/g, "<span class='letter'>$&</span>");
            
            anime.timeline({loop: false})
              .add({
                targets: '#anime-text-target .letter',
                translateY: [10, 0], 
                opacity: [0, 1],    
                easing: "easeOutExpo",
                duration: 600,
                delay: anime.stagger(50) 
              }).add({ 
                targets: '#anime-text-target .letter',
                opacity: 1, 
                duration: 1500, 
                complete: function(anim) {
                   anime({ 
                     targets: '#anime-text-target .letter',
                     translateY: [0, -10], 
                     opacity: [1, 0],     
                     easing: "easeInExpo",
                     duration: 400,
                     delay: anime.stagger(30, {direction: 'reverse'}),
                     complete: function() {
                         wordIndex = (wordIndex + 1) % words.length;
                         animationTimeout = setTimeout(animateWord, 100); 
                     }
                   });
                }
              });
        }
        
        // --- Timezone Update Logic ---
        const timeElement = document.getElementById('current-time');
        const utcTimeElement = document.getElementById('utc-time');
        const estTimeElement = document.getElementById('est-time');
        const pstTimeElement = document.getElementById('pst-time');
        const cetTimeElement = document.getElementById('cet-time');

        function updateTime() {
             const now = new Date();
             const options = { hour: '2-digit', minute: '2-digit', hour12: true };

             if (timeElement) {
                 timeElement.textContent = now.toLocaleTimeString('en-US', { ...options, timeZone: 'Asia/Kuala_Lumpur' });
             }
             if (utcTimeElement) {
                 utcTimeElement.textContent = now.toLocaleTimeString('en-US', { ...options, timeZone: 'UTC' });
             }
             if (estTimeElement) {
                 estTimeElement.textContent = now.toLocaleTimeString('en-US', { ...options, timeZone: 'America/New_York' });
             }
              if (pstTimeElement) {
                 pstTimeElement.textContent = now.toLocaleTimeString('en-US', { ...options, timeZone: 'America/Los_Angeles' });
             }
             if (cetTimeElement) {
                 cetTimeElement.textContent = now.toLocaleTimeString('en-US', { ...options, timeZone: 'Europe/Berlin' });
             }
        }

        // --- LIVE Weather Fetch Logic (Open-Meteo) ---
        
        // UPDATED: New two-tone icons
        const weatherIcons = {
            sunny: `
                <path d="M8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8" fill="#FDB813"/>
                <path d="M8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0m0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13m-5-6.5a.5.5 0 0 1 .5-.5h2a.5.5 0 0 1 0 1h-2a.5.5 0 0 1-.5-.5m11 0a.5.5 0 0 1 .5-.5h2a.5.5 0 0 1 0 1h-2a.5.5 0 0 1-.5-.5m-9.757-2.121a.5.5 0 0 1 .707 0l1.414 1.414a.5.5 0 1 1-.707.707L3.243 5.05a.5.5 0 0 1 0-.707m9.9 9.9a.5.5 0 0 1 .707 0l1.414 1.414a.5.5 0 1 1-.707.707L12.757 14.95a.5.5 0 0 1 0-.707m-9.9-7.07a.5.5 0 0 1 0 .707L5.05 12.757a.5.5 0 0 1-.707.707L2.929 12.05a.5.5 0 0 1 .707-.707m9.9 0a.5.5 0 0 1 0 .707L14.95 12.757a.5.5 0 0 1-.707.707L12.828 12.05a.5.5 0 0 1 .707-.707" fill="currentColor"/>
            `,
            nightClear: `
                <path d="M6 .278a.77.77 0 0 1 .08.858 7.2 7.2 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277q.792 0 1.57-.122a.77.77 0 0 1 .979.81A8.96 8.96 0 0 1 8.998 16a8.993 8.993 0 0 1-8.7-9.347A8.96 8.96 0 0 1 6 .278" fill="#F3E5AB"/>
            `,
            cloudy: `
                <path d="M13.405 7.027a5.001 5.001 0 0 0-9.499-1.004A3.5 3.5 0 1 0 3.5 13H13a3 3 0 0 0 .405-5.973" fill="currentColor" opacity="0.7"/>
            `,
            partlyCloudyDay: `
                <path d="M8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8" fill="#FDB813" style="transform: translate(-2px, -2px); z-index: 1;"/>
                <path d="M13.405 7.027a5.001 5.001 0 0 0-9.499-1.004A3.5 3.5 0 1 0 3.5 13H13a3 3 0 0 0 .405-5.973" fill="currentColor" opacity="0.7" style="z-index: 2;"/>
            `,
            partlyCloudyNight: `
                <path d="M6 .278a.77.77 0 0 1 .08.858 7.2 7.2 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277q.792 0 1.57-.122a.77.77 0 0 1 .979.81A8.96 8.96 0 0 1 8.998 16a8.993 8.993 0 0 1-8.7-9.347A8.96 8.96 0 0 1 6 .278" fill="#F3E5AB" style="transform: scale(0.6) translate(6px, -5px); z-index: 1;"/>
                <path d="M11.473 11a5 5 0 0 0-8.72-.99A3.5 3.5 0 0 0 3.5 13H9.5a3 3 0 0 0 .405-5.973.77.77 0 0 1 .08.858 7.2 7.2 0 0 0-.878 3.46c0 1.39.37 2.678 1.005 3.666" fill="currentColor" opacity="0.7" style="z-index: 2;"/>
            `,
            rainy: `
                <path d="M4.158 12.025a.5.5 0 0 1 .316.633l-.5 1.5a.5.5 0 0 1-.948-.316l.5-1.5a.5.5 0 0 1 .632-.317m3 0a.5.5 0 0 1 .316.633l-.5 1.5a.5.5 0 0 1-.948-.316l.5-1.5a.5.5 0 0 1 .632-.317m3 0a.5.5 0 0 1 .316.633l-.5 1.5a.5.5 0 0 1-.948-.316l.5-1.5a.5.5 0 0 1 .632-.317m3 0a.5.5 0 0 1 .316.633l-.5 1.5a.5.5 0 0 1-.948-.316l.5-1.5a.5.5 0 0 1 .632-.317" fill="#4682B4"/>
                <path d="M13.405 7.027a5.001 5.001 0 0 0-9.499-1.004A3.5 3.5 0 1 0 3.5 13H13a3 3 0 0 0 .405-5.973" fill="currentColor" opacity="0.7"/>
            `,
            lightRain: `
                <path d="M5.158 12.025a.5.5 0 0 1 .316.633l-.5 1.5a.5.5 0 0 1-.948-.316l.5-1.5a.5.5 0 0 1 .632-.317m3 0a.5.5 0 0 1 .316.633l-.5 1.5a.5.5 0 0 1-.948-.316l.5-1.5a.5.5 0 0 1 .632-.317m3 0a.5.5 0 0 1 .316.633l-.5 1.5a.5.5 0 0 1-.948-.316l.5-1.5a.5.5 0 0 1 .632-.317" fill="#87CEEB"/>
                <path d="M13.405 7.027a5.001 5.001 0 0 0-9.499-1.004A3.5 3.5 0 1 0 3.5 13H13a3 3 0 0 0 .405-5.973" fill="currentColor" opacity="0.6"/>
            `,
            rain: `
                <path d="M4.158 12.025a.5.5 0 0 1 .316.633l-.5 1.5a.5.5 0 0 1-.948-.316l.5-1.5a.5.5 0 0 1 .632-.317m3 0a.5.5 0 0 1 .316.633l-.5 1.5a.5.5 0 0 1-.948-.316l.5-1.5a.5.5 0 0 1 .632-.317m3 0a.5.5 0 0 1 .316.633l-.5 1.5a.5.5 0 0 1-.948-.316l.5-1.5a.5.5 0 0 1 .632-.317m3 0a.5.5 0 0 1 .316.633l-.5 1.5a.5.5 0 0 1-.948-.316l.5-1.5a.5.5 0 0 1 .632-.317" fill="#4682B4"/>
                <path d="M13.405 7.027a5.001 5.001 0 0 0-9.499-1.004A3.5 3.5 0 1 0 3.5 13H13a3 3 0 0 0 .405-5.973" fill="currentColor" opacity="0.7"/>
            `,
            heavyRain: `
                <path d="M3.158 12.025a.5.5 0 0 1 .316.633l-.5 1.5a.5.5 0 0 1-.948-.316l.5-1.5a.5.5 0 0 1 .632-.317m2 0a.5.5 0 0 1 .316.633l-.5 1.5a.5.5 0 0 1-.948-.316l.5-1.5a.5.5 0 0 1 .632-.317m2 0a.5.5 0 0 1 .316.633l-.5 1.5a.5.5 0 0 1-.948-.316l.5-1.5a.5.5 0 0 1 .632-.317m2 0a.5.5 0 0 1 .316.633l-.5 1.5a.5.5 0 0 1-.948-.316l.5-1.5a.5.5 0 0 1 .632-.317m2 0a.5.5 0 0 1 .316.633l-.5 1.5a.5.5 0 0 1-.948-.316l.5-1.5a.5.5 0 0 1 .632-.317m2 0a.5.5 0 0 1 .316.633l-.5 1.5a.5.5 0 0 1-.948-.316l.5-1.5a.5.5 0 0 1 .632-.317" fill="#1E3A8A"/>
                <path d="M13.405 7.027a5.001 5.001 0 0 0-9.499-1.004A3.5 3.5 0 1 0 3.5 13H13a3 3 0 0 0 .405-5.973" fill="currentColor" opacity="0.8"/>
            `,
            fog: `
                <path d="M2 8h12M2 10h12M2 12h12" stroke="currentColor" stroke-width="1.5" opacity="0.5"/>
                <path d="M13.405 7.027a5.001 5.001 0 0 0-9.499-1.004A3.5 3.5 0 1 0 3.5 13H13a3 3 0 0 0 .405-5.973" fill="currentColor" opacity="0.4"/>
            `,
            snow: `
                <path d="M8 1v14M1 8h14M3.5 3.5l9 9M12.5 3.5l-9 9" stroke="currentColor" stroke-width="1" opacity="0.6"/>
                <circle cx="8" cy="3" r="0.8" fill="currentColor" opacity="0.8"/>
                <circle cx="8" cy="13" r="0.8" fill="currentColor" opacity="0.8"/>
                <circle cx="3" cy="8" r="0.8" fill="currentColor" opacity="0.8"/>
                <circle cx="13" cy="8" r="0.8" fill="currentColor" opacity="0.8"/>
                <path d="M13.405 7.027a5.001 5.001 0 0 0-9.499-1.004A3.5 3.5 0 1 0 3.5 13H13a3 3 0 0 0 .405-5.973" fill="currentColor" opacity="0.5"/>
            `, 
            thunder: `
                <path d="M5.301 3.164a.5.5 0 0 1 .59.037L9.5 5.5h2.02a.5.5 0 0 1 .454.72l-2 4a.5.5 0 0 1-.884-.437L9.08 7.5H7.5a.5.5 0 0 1-.454-.72l2-4a.5.5 0 0 1 .255-.276" fill="#FDB813" style="z-index: 2;"/>
                <path d="M13.405 7.027a5.001 5.001 0 0 0-9.499-1.004A3.5 3.5 0 1 0 3.5 13H13a3 3 0 0 0 .405-5.973" fill="currentColor" opacity="0.7" style="z-index: 1;"/>
            `,
            // UPDATED: New Google/Samsung inspired sunset icon
            sunset: `
                <path d="M8 12a4 4 0 0 0 4-4H4a4 4 0 0 0 4 4" fill="#FDB813" />
                <path d="M1 12h14" stroke="currentColor" stroke-width="1" opacity="0.7" />
                <path d="M8 5l-2 2h4l-2-2z" fill="currentColor" opacity="0.7" />
            `
        };

        // Maps WMO codes to text and icon
        function getWeatherDetails(code, isDay = 1) {
            // WMO Weather interpretation codes with detailed icons
            const codes = {
                0: { text: "Clear sky", icon: isDay ? weatherIcons.sunny : weatherIcons.nightClear },
                1: { text: "Mainly clear", icon: isDay ? weatherIcons.sunny : weatherIcons.nightClear },
                2: { text: "Partly cloudy", icon: isDay ? weatherIcons.partlyCloudyDay : weatherIcons.partlyCloudyNight },
                3: { text: "Overcast", icon: weatherIcons.cloudy },
                45: { text: "Fog", icon: weatherIcons.fog },
                48: { text: "Depositing rime fog", icon: weatherIcons.fog },
                51: { text: "Light drizzle", icon: weatherIcons.lightRain },
                53: { text: "Moderate drizzle", icon: weatherIcons.lightRain },
                55: { text: "Dense drizzle", icon: weatherIcons.rain },
                56: { text: "Light freezing drizzle", icon: weatherIcons.lightRain },
                57: { text: "Dense freezing drizzle", icon: weatherIcons.rain },
                61: { text: "Slight rain", icon: weatherIcons.lightRain },
                63: { text: "Moderate rain", icon: weatherIcons.rain },
                65: { text: "Heavy rain", icon: weatherIcons.heavyRain },
                66: { text: "Light freezing rain", icon: weatherIcons.lightRain },
                67: { text: "Heavy freezing rain", icon: weatherIcons.heavyRain },
                71: { text: "Slight snow fall", icon: weatherIcons.snow },
                73: { text: "Moderate snow fall", icon: weatherIcons.snow },
                75: { text: "Heavy snow fall", icon: weatherIcons.snow },
                77: { text: "Snow grains", icon: weatherIcons.snow },
                80: { text: "Slight rain showers", icon: weatherIcons.lightRain },
                81: { text: "Moderate rain showers", icon: weatherIcons.rain },
                82: { text: "Violent rain showers", icon: weatherIcons.heavyRain },
                85: { text: "Slight snow showers", icon: weatherIcons.snow },
                86: { text: "Heavy snow showers", icon: weatherIcons.snow },
                95: { text: "Thunderstorm", icon: weatherIcons.thunder },
                96: { text: "Thunderstorm with slight hail", icon: weatherIcons.thunder },
                99: { text: "Thunderstorm with heavy hail", icon: weatherIcons.thunder }
            };
            return codes[code] || { text: "Clear", icon: isDay ? weatherIcons.sunny : weatherIcons.nightClear };
        }

        // Get short weather text for forecast display
        function getShortWeatherText(code) {
            const shortText = {
                0: "Clear", 1: "Clear", 2: "Partly Cloudy", 3: "Cloudy",
                45: "Fog", 48: "Fog",
                51: "Light Rain", 53: "Light Rain", 55: "Rain", 56: "Freezing Rain", 57: "Freezing Rain",
                61: "Light Rain", 63: "Rain", 65: "Heavy Rain",
                66: "Freezing Rain", 67: "Heavy Rain",
                71: "Snow", 73: "Snow", 75: "Heavy Snow", 77: "Snow",
                80: "Light Showers", 81: "Showers", 82: "Heavy Showers",
                85: "Snow", 86: "Heavy Snow",
                95: "Thunderstorm", 96: "Thunderstorm", 99: "Thunderstorm"
            };
            return shortText[code] || "Clear";
        }

        async function fetchWeather() {
            const weatherElement = document.getElementById('current-weather');
            const weatherIcon = document.getElementById('weather-icon'); // Get the SVG element
            const forecastContainer = document.getElementById('hourly-forecast-container');
            const sunsetInfoElement = document.getElementById('sunset-info'); // Get the whole div
            const sunsetElement = sunsetInfoElement.querySelector('span');
            const sunsetIconSvg = document.getElementById('sunset-icon-svg'); // Get the sunset icon SVG
            
            // More accurate Kuala Lumpur city center coordinates (KLCC area)
            const lat = 3.1569;
            const lon = 101.7123;
            // Enhanced API call with more weather parameters for better accuracy
            const url = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current=temperature_2m,relative_humidity_2m,apparent_temperature,weather_code,is_day,precipitation,wind_speed_10m&hourly=temperature_2m,weather_code,precipitation_probability,precipitation,is_day&daily=sunset,sunrise,precipitation_sum&forecast_days=2&timezone=Asia%2FKuala_Lumpur`;

            try {
                const response = await fetch(url);
                if (!response.ok) {
                    throw new Error(`Weather API error: ${response.statusText}`);
                }
                const data = await response.json();
                
                // --- Process CURRENT weather ---
                const temp = Math.round(data.current.temperature_2m);
                const feelsLikeTemp = Math.round(data.current.apparent_temperature); // NEW: Get "feels like"
                const humidity = data.current.relative_humidity_2m;
                const weatherCode = data.current.weather_code;
                const isDay = data.current.is_day; // NEW: Get is_day (1 for day, 0 for night)
                const weatherDetails = getWeatherDetails(weatherCode, isDay); // UPDATED: Pass isDay

                if (weatherElement) {
                    // UPDATED: Include "feels like" temperature
                    weatherElement.textContent = `${temp}°C (Feels ${feelsLikeTemp}°), ${weatherDetails.text}`;
                }
                if (weatherIcon) {
                    // UPDATED: Set innerHTML to the new icon path
                    weatherIcon.innerHTML = weatherDetails.icon;
                }
                
                // --- Process SUNSET ---
                const sunsetTimeStr = data.daily.sunset[0]; // Use today's sunset
                const sunsetDate = new Date(sunsetTimeStr);
                // UPDATED: Format sunset time to 24-hour (e.g., "18:56")
                const sunsetTime = sunsetDate.toLocaleTimeString('en-US', {
                    hour: '2-digit',
                    minute: '2-digit',
                    hour12: false,
                    timeZone: 'Asia/Kuala_Lumpur'
                }); // e.g., "18:56"
                
                if (sunsetElement) {
                    sunsetElement.textContent = `Sunset will be at ${sunsetTime}`; // e.g., "Sunset will be at 18:56"
                }
                if (sunsetIconSvg) {
                    sunsetIconSvg.innerHTML = weatherIcons.sunset; // Set the sunset icon paths
                }
                const sunsetHour = sunsetDate.getHours(); // e.g., 18

                // --- Process HOURLY forecast ---
                if (forecastContainer) {
                    forecastContainer.innerHTML = ''; // Clear previous forecast
                    const hourlyData = data.hourly;
                    
                    // --- FIX: Find the index for the *next* hour ---
                    const now = new Date();
                    // Find the first hour in the forecast that is *after* the current time
                    let startIndex = hourlyData.time.findIndex(time => new Date(time) > now);
                    if (startIndex === -1) {
                         // If all hours are in the past (unlikely), default to last 5
                         startIndex = Math.max(0, hourlyData.time.length - 5);
                    }
                    // --- End of FIX ---
                    
                    // Show 5 hours of forecast
                    const endIndex = Math.min(startIndex + 5, hourlyData.time.length);

                    for (let i = startIndex; i < endIndex; i++) {
                        const timeStr = hourlyData.time[i];
                        const hourDate = new Date(timeStr);
                        const hour = hourDate.getHours();
                        
                        // UPDATED: Format time to 24-hour (e.g., "19:00")
                        let timeLabel = hourDate.toLocaleTimeString('en-US', {
                            hour: '2-digit',
                            minute: '2-digit', // Added minutes
                            hour12: false,
                            timeZone: 'Asia/Kuala_Lumpur'
                        }); // e.g., "19:00"

                        const hourlyTemp = Math.round(hourlyData.temperature_2m[i]);
                        const hourlyCode = hourlyData.weather_code[i];
                        const hourlyPrecip = hourlyData.precipitation_probability[i];
                        const hourlyIsDay = hourlyData.is_day[i];
                        let hourlyWeatherDetails = getWeatherDetails(hourlyCode, hourlyIsDay);
                        
                        const item = document.createElement('div');
                        item.className = 'forecast-item';
                        
                        let tempLabel = `${hourlyTemp}°`;
                        let iconPaths = hourlyWeatherDetails.icon;
                        let weatherText = getShortWeatherText(hourlyCode);

                        item.innerHTML = `
                            <span style="font-size: 0.75em;">${timeLabel}</span>
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" title="${hourlyWeatherDetails.text}">
                                ${iconPaths}
                            </svg>
                            <span class="temp">${tempLabel}</span>
                            <span class="precip" style="font-size: 0.65em; font-weight: 500;">${weatherText}</span>
                        `;
                        forecastContainer.appendChild(item);
                    }
                }

            } catch (error)
             {
                console.error("Failed to fetch live weather:", error);
                if (weatherElement) {
                    weatherElement.textContent = "Weather unavailable";
                }
                 if (weatherIcon) {
                    // UPDATED: Set innerHTML to the default icon path on error
                    weatherIcon.innerHTML = weatherIcons.sunny;
                }
                if (forecastContainer) {
                    forecastContainer.innerHTML = '<span class="text-xs text-red-500 opacity-70">Forecast unavailable</span>';
                }
                if (sunsetElement) {
                    sunsetElement.textContent = "Sunset time unavailable";
                }
                if (sunsetIconSvg) {
                    sunsetIconSvg.innerHTML = weatherIcons.sunset;
                }
            }
        }
        
        // --- RainViewer Radar Integration ---
        let rainRadarMap = null;
        let radarLayer = null;
        
        function initRainRadar() {
            const mapContainer = document.getElementById('rain-radar-map');
            if (!mapContainer) {
                console.error('Rain radar map container not found');
                return;
            }
            
            // Kuala Lumpur city center coordinates
            const klLat = 3.1569;
            const klLon = 101.7123;
            
            // Initialize Leaflet map centered on KL - MORE ZOOMED OUT, FULLY INTERACTIVE
            rainRadarMap = L.map('rain-radar-map', {
                center: [klLat, klLon],
                zoom: 8.5, // More zoomed out to see more cities (was 10)
                zoomControl: true, // Show zoom buttons
                attributionControl: false,
                dragging: true, // Enable dragging
                scrollWheelZoom: true, // Enable zoom with mouse wheel
                doubleClickZoom: true, // Enable double click zoom
                touchZoom: true, // Enable touch zoom
                minZoom: 7, // Minimum zoom level
                maxZoom: 12 // Maximum zoom level
            });
            
            // Add dark base map
            L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
                maxZoom: 19
            }).addTo(rainRadarMap);
            
            // Add KL marker with popup
            const klIcon = L.divIcon({
                className: 'kl-marker',
                html: '<div style="width: 10px; height: 10px; background: #00ff00; border: 2px solid #fff; border-radius: 50%; box-shadow: 0 0 10px #00ff00;"></div>',
                iconSize: [14, 14]
            });
            L.marker([klLat, klLon], { icon: klIcon })
                .bindPopup('<b>Kuala Lumpur</b><br>City Center')
                .addTo(rainRadarMap);
            
            // Load RainViewer radar data
            updateRadarLayer();
            
            // Update radar every 5 minutes
            setInterval(updateRadarLayer, 300000);
        }
        
        function updateRadarLayer() {
            if (!rainRadarMap) return;
            
            // Fetch latest radar timestamps from RainViewer API
            fetch('https://api.rainviewer.com/public/weather-maps.json')
                .then(response => response.json())
                .then(data => {
                    if (!data || !data.radar || !data.radar.past || data.radar.past.length === 0) {
                        console.error('No radar data available');
                        return;
                    }
                    
                    // Get the most recent radar frame
                    const latestFrame = data.radar.past[data.radar.past.length - 1];
                    const radarUrl = `https://tilecache.rainviewer.com${latestFrame.path}/256/{z}/{x}/{y}/2/1_1.png`;
                    
                    // Remove old radar layer
                    if (radarLayer) {
                        rainRadarMap.removeLayer(radarLayer);
                    }
                    
                    // Add new radar layer with maximum opacity for brightest colors
                    radarLayer = L.tileLayer(radarUrl, {
                        opacity: 1.0,
                        maxZoom: 19
                    }).addTo(rainRadarMap);
                })
                .catch(error => {
                    console.error('Error fetching radar data:', error);
                });
        }
        
        // --- REMOVED: GEMINI API FUNCTIONS ---

        // --- FaultyTerminal Background Logic ---
        let terminalInstance = null;
        let letterGlitchInstance = null;
        let plasmaInstance = null;
        let liquidChromeInstance = null;
        
        function initFaultyTerminal() {
            console.log('initFaultyTerminal called');
            const terminalContainer = document.getElementById('terminal-bg-project');
            if (!terminalContainer) {
                console.error('Terminal container not found!');
                return;
            }
            
            console.log('Terminal container found:', terminalContainer);
            
            // Clean up existing instance
            if (terminalInstance) {
                console.log('Destroying existing terminal instance');
                terminalInstance.destroy();
                terminalInstance = null;
            }
            
            // Check if FaultyTerminal class exists
            if (typeof FaultyTerminal === 'undefined') {
                console.error('FaultyTerminal class not found! Retrying...');
                setTimeout(initFaultyTerminal, 100);
                return;
            }
            
            console.log('Creating FaultyTerminal instance...');
            
            try {
                // Create new terminal instance
                terminalInstance = new FaultyTerminal(terminalContainer, {
                    tint: '#4a6741', // Grayish-green forest color
                    mouseReact: true,
                    timeScale: 1,
                    brightness: 1
                });
                console.log('FaultyTerminal instance created successfully!', terminalInstance);
            } catch (error) {
                console.error('Error creating FaultyTerminal:', error);
            }
        }
        
        // Load the FaultyTerminal script
        function loadFaultyTerminalScript() {
            console.log('Loading FaultyTerminal script...');
            const script = document.createElement('script');
            script.src = './FaultyTerminal.js';
            script.onload = () => {
                console.log('FaultyTerminal script loaded successfully');
            };
            script.onerror = () => {
                console.error('Failed to load FaultyTerminal.js');
            };
            document.head.appendChild(script);
        }
        
        // --- LetterGlitch Background Logic ---
        function initLetterGlitch() {
            console.log('initLetterGlitch called');
            const letterGlitchContainer = document.getElementById('letter-glitch-bg-reference');
            if (!letterGlitchContainer) {
                console.error('LetterGlitch container not found!');
                return;
            }
            
            console.log('LetterGlitch container found:', letterGlitchContainer);
            
            // Clean up existing instance
            if (letterGlitchInstance) {
                console.log('Destroying existing LetterGlitch instance');
                letterGlitchInstance.destroy();
                letterGlitchInstance = null;
            }
            
            // Check if LetterGlitch class exists
            if (typeof LetterGlitch === 'undefined') {
                console.error('LetterGlitch class not found! Retrying...');
                setTimeout(initLetterGlitch, 100);
                return;
            }
            
            console.log('Creating LetterGlitch instance...');
            
            try {
                // OPTIMIZED: Performance settings with smooth transitions
                letterGlitchInstance = new LetterGlitch(letterGlitchContainer, {
                    glitchSpeed: 150, // Slower = less CPU usage
                    centerVignette: true,
                    outerVignette: false,
                    smooth: true // Enable smooth transitions for better visual
                });
                console.log('LetterGlitch instance created successfully!', letterGlitchInstance);
            } catch (error) {
                console.error('Error creating LetterGlitch:', error);
            }
        }
        
        // Load the LetterGlitch script
        function loadLetterGlitchScript() {
            console.log('Loading LetterGlitch script...');
            const script = document.createElement('script');
            script.src = './LetterGlitch.js';
            script.onload = () => {
                console.log('LetterGlitch script loaded successfully');
            };
            script.onerror = () => {
                console.error('Failed to load LetterGlitch.js');
            };
            document.head.appendChild(script);
        }
        
        // --- Plasma Background Logic ---
        function initPlasma() {
            console.log('initPlasma called');
            const plasmaContainer = document.getElementById('plasma-bg-aboutme');
            if (!plasmaContainer) {
                console.error('Plasma container not found!');
                return;
            }
            
            console.log('Plasma container found:', plasmaContainer);
            
            // Clean up existing instance
            if (plasmaInstance) {
                console.log('Destroying existing Plasma instance');
                plasmaInstance.destroy();
                plasmaInstance = null;
            }
            
            // Check if Plasma class exists
            if (typeof Plasma === 'undefined') {
                console.error('Plasma class not found! Retrying...');
                setTimeout(initPlasma, 100);
                return;
            }
            
            console.log('Creating Plasma instance...');
            
            try {
                // Create new Plasma instance
                plasmaInstance = new Plasma(plasmaContainer, {
                    color: '#b19cd9',
                    speed: 0.6,
                    direction: 'forward',
                    scale: 1.1,
                    opacity: 0.8,
                    mouseInteractive: true
                });
                console.log('Plasma instance created successfully!', plasmaInstance);
            } catch (error) {
                console.error('Error creating Plasma:', error);
            }
        }
        
        // Load the Plasma script
        function loadPlasmaScript() {
            console.log('Loading Plasma script...');
            const script = document.createElement('script');
            script.src = './Plasma.js';
            script.onload = () => {
                console.log('Plasma script loaded successfully');
            };
            script.onerror = () => {
                console.error('Failed to load Plasma.js');
            };
            document.head.appendChild(script);
        }
        
        // --- LiquidChrome Background Logic ---
        function initLiquidChrome() {
            console.log('initLiquidChrome called');
            const liquidChromeContainer = document.getElementById('liquid-chrome-bg-contact');
            if (!liquidChromeContainer) {
                console.error('LiquidChrome container not found!');
                return;
            }
            
            console.log('LiquidChrome container found:', liquidChromeContainer);
            
            // Clean up existing instance
            if (liquidChromeInstance) {
                console.log('Destroying existing LiquidChrome instance');
                liquidChromeInstance.destroy();
                liquidChromeInstance = null;
            }
            
            // Check if LiquidChrome class exists
            if (typeof LiquidChrome === 'undefined') {
                console.error('LiquidChrome class not found! Retrying...');
                setTimeout(initLiquidChrome, 100);
                return;
            }
            
            console.log('Creating LiquidChrome instance...');
            
            try {
                // Create new LiquidChrome instance
                liquidChromeInstance = new LiquidChrome(liquidChromeContainer, {
                    baseColor: [0.1, 0.1, 0.1],
                    speed: 0.3,
                    amplitude: 0.6,
                    frequencyX: 3,
                    frequencyY: 3,
                    interactive: true
                });
                console.log('LiquidChrome instance created successfully!', liquidChromeInstance);
            } catch (error) {
                console.error('Error creating LiquidChrome:', error);
            }
        }
        
        // Load the LiquidChrome script
        function loadLiquidChromeScript() {
            console.log('Loading LiquidChrome script...');
            const script = document.createElement('script');
            script.src = './LiquidChrome.js';
            script.onload = () => {
                console.log('LiquidChrome script loaded successfully');
            };
            script.onerror = () => {
                console.error('Failed to load LiquidChrome.js');
            };
            document.head.appendChild(script);
        }

        // --- ClickSpark Effect Logic ---
        let clickSparkInstance = null;

        function initClickSpark() {
            console.log('Initializing ClickSpark...');
            if (typeof ClickSpark === 'undefined') {
                console.error('ClickSpark class not found!');
                return;
            }

            try {
                // Determine color based on current theme
                const isDark = document.documentElement.classList.contains('dark');
                const sparkColor = isDark ? '#ffffff' : '#000000';

                clickSparkInstance = new ClickSpark({
                    sparkColor: sparkColor,
                    sparkSize: 10,
                    sparkRadius: 15,
                    sparkCount: 8,
                    duration: 400,
                    easing: 'ease-out'
                });
                console.log('ClickSpark initialized successfully with color:', sparkColor);
            } catch (error) {
                console.error('Error creating ClickSpark:', error);
            }
        }

        // Update ClickSpark color when theme changes
        function updateClickSparkColor() {
            if (!clickSparkInstance) return;
            
            const isDark = document.documentElement.classList.contains('dark');
            clickSparkInstance.options.sparkColor = isDark ? '#ffffff' : '#000000';
            console.log('ClickSpark color updated:', clickSparkInstance.options.sparkColor);
        }

        // Load the ClickSpark script
        function loadClickSparkScript() {
            console.log('Loading ClickSpark script...');
            const script = document.createElement('script');
            script.src = './ClickSpark.js';
            script.onload = () => {
                console.log('ClickSpark script loaded successfully');
                initClickSpark();
            };
            script.onerror = () => {
                console.error('Failed to load ClickSpark.js');
            };
            document.head.appendChild(script);
        }

        // Load the MetallicPaint script first
        function loadMetallicPaintScript() {
            console.log('Loading MetallicPaint script...');
            const script = document.createElement('script');
            script.src = './MetallicPaint.js';
            script.onload = () => {
                console.log('MetallicPaint script loaded successfully');
                loadCardNavScript();
            };
            script.onerror = () => {
                console.error('Failed to load MetallicPaint.js');
                loadCardNavScript(); // Still load CardNav even if MetallicPaint fails
            };
            document.head.appendChild(script);
        }

        // Load the CardNav script
        function loadCardNavScript() {
            console.log('Loading CardNav script...');
            const script = document.createElement('script');
            script.src = './CardNav.js';
            script.onload = () => {
                console.log('CardNav script loaded successfully');
                initCardNav();
            };
            script.onerror = () => {
                console.error('Failed to load CardNav.js');
            };
            document.head.appendChild(script);
        }

        // Initialize CardNav with navigation items
        function initCardNav() {
            console.log('initCardNav called');
            
            if (typeof CardNav === 'undefined') {
                console.error('CardNav class not found');
                return;
            }

            const container = document.getElementById('card-nav');
            if (!container) {
                console.error('CardNav container not found');
                return;
            }

            console.log('CardNav container found:', container);

            // Define navigation categories with sections
            const navCategories = [
                {
                    id: 'navigation',
                    name: 'Navigation',
                    sections: [
                        {
                            title: 'Home',
                            subtitle: '3D showcase, main landing page',
                            pageId: 'home',
                            dotColor: '#ef4444' // Red
                        }
                    ]
                },
                {
                    id: 'portfolio',
                    name: 'Portfolio',
                    sections: [
                        {
                            title: 'About Me',
                            subtitle: 'Personal story, skills, background',
                            pageId: 'aboutMe',
                            dotColor: '#3b82f6' // Blue
                        },
                        {
                            title: 'Project',
                            subtitle: 'Work showcase, development portfolio',
                            pageId: 'project',
                            dotColor: '#f97316' // Orange
                        },
                        {
                            title: 'Contact',
                            subtitle: 'Get in touch, social links',
                            pageId: 'contact',
                            dotColor: '#10b981' // Green
                        },
                        {
                            title: 'Reference',
                            subtitle: 'Documentation, credits, resources',
                            pageId: 'reference',
                            dotColor: '#8b5cf6' // Purple
                        }
                    ]
                }
            ];

            // Initialize CardNav
            const cardNav = new CardNav(container, {
                categories: navCategories
            });

            console.log('CardNav initialized');
            
            // Initialize scroll animation for navigation with slight delay
            setTimeout(() => {
                initNavScrollAnimation();
            }, 500);
        }
        
        
        // Scroll-based animation for navigation
        function initNavScrollAnimation() {
            const navContainer = document.querySelector('.card-nav-container');
            const scrollContainer = document.querySelector('.page-content');
            
            console.log('Attempting to init scroll animation');
            console.log('Nav container:', navContainer);
            console.log('Scroll container:', scrollContainer);
            
            if (!navContainer) {
                console.log('Nav container not found!');
                return;
            }
            
            if (!scrollContainer) {
                console.log('Scroll container not found! Using window instead');
            }
            
            console.log('Nav scroll animation initialized successfully!');
            
            let lastScrollY = 0;
            
            const handleScroll = () => {
                const currentScrollY = scrollContainer ? scrollContainer.scrollTop : window.scrollY;
                console.log('Scrolling! Position:', currentScrollY, 'Last:', lastScrollY);
                
                // Scrolling down - hide nav
                if (currentScrollY > lastScrollY && currentScrollY > 100) {
                    console.log('→ Hiding nav');
                    navContainer.style.opacity = '0';
                    navContainer.style.transform = 'translateX(-50%) translateY(-20px)';
                    navContainer.style.pointerEvents = 'none';
                } 
                // Scrolling up - show nav
                else if (currentScrollY < lastScrollY) {
                    console.log('→ Showing nav (scrolling up)');
                    navContainer.style.opacity = '1';
                    navContainer.style.transform = 'translateX(-50%) translateY(0)';
                    navContainer.style.pointerEvents = 'auto';
                }
                // At the very top - show nav
                else if (currentScrollY <= 100) {
                    console.log('→ Showing nav (at top)');
                    navContainer.style.opacity = '1';
                    navContainer.style.transform = 'translateX(-50%) translateY(0)';
                    navContainer.style.pointerEvents = 'auto';
                }
                
                lastScrollY = currentScrollY;
            };
            
            // Add scroll listener to the actual scrolling element
            if (scrollContainer) {
                scrollContainer.addEventListener('scroll', handleScroll, { passive: true });
                console.log('Scroll listener attached to .page-content!');
            } else {
                window.addEventListener('scroll', handleScroll, { passive: true });
                console.log('Scroll listener attached to window!');
            }
        }

    </script>
</body>
</html>